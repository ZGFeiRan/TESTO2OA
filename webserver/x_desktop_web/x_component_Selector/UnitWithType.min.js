MWF.xApplication.Selector=MWF.xApplication.Selector||{};MWF.xDesktop.requireApp("Selector","Unit",null,false);MWF.xApplication.Selector.UnitWithType=new Class({Extends:MWF.xApplication.Selector.Unit,options:{style:"default",count:0,title:MWF.xApplication.Selector.LP.selectUnit,units:[],unitType:"",values:[],zIndex:1e3,expand:true},loadSelectItems:function(t){debugger;var e={};e.type=this.options.unitType;e.unitList=[];this.options.units.each(function(t){if(typeOf(t)==="string"){e.unitList.push(t)}else{e.unitList.push(t.distinguishedName)}}.bind(this));this.orgAction.listUnitByType(function(t){if(t.data.length){t.data.each(function(t){if(!this.options.unitType||t.typeList.indexOf(this.options.unitType)!==-1){var e=this._newItem(t,this,this.itemAreaNode,1)}else{if(t.woSubDirectUnitList.length)var i=this._newItemCategory("ItemCategory",t,this,this.itemAreaNode)}}.bind(this))}}.bind(this),null,e)},_scrollEvent:function(t){return true},_getChildrenItemIds:function(){return null},_newItemCategory:function(t,e,i,n,s){return new MWF.xApplication.Selector.UnitWithType[t](e,i,n,s)},_listItemByKey:function(e,t,i){i={key:i};if(this.options.units.length){var n=[];this.options.units.each(function(t){if(typeOf(t)==="string"){n.push(t)}if(typeOf(t)==="object"){n.push(t.distinguishedName)}});i.unitList=n}if(this.options.unitType)i.type=this.options.unitType;this.orgAction.listUnitByKey(function(t){if(e)e.apply(this,[t])}.bind(this),t,i)},_getItem:function(e,t,i,n){this.orgAction.getUnit(function(t){if(e)e.apply(this,[t])}.bind(this),t,typeOf(i)==="string"?i:i.distinguishedName,n)},_newItemSelected:function(t,e,i){return new MWF.xApplication.Selector.UnitWithType.ItemSelected(t,e,i)},_listItemByPinyin:function(e,t,i){i={key:i};if(this.options.units.length){var n=[];this.options.units.each(function(t){if(typeOf(t)==="string"){n.push(t)}if(typeOf(t)==="object"){n.push(t.distinguishedName)}});i.unitList=n}if(this.options.unitType)i.type=this.options.unitType;this.orgAction.listUnitByPinyininitial(function(t){if(e)e.apply(this,[t])}.bind(this),t,i)},_newItem:function(t,e,i,n){return new MWF.xApplication.Selector.UnitWithType.Item(t,e,i,n)},_newItemSearch:function(t,e,i,n){return new MWF.xApplication.Selector.UnitWithType.SearchItem(t,e,i,n)}});MWF.xApplication.Selector.UnitWithType.Item=new Class({Extends:MWF.xApplication.Selector.Unit.Item,_getShowName:function(){return this.data.name},_setIcon:function(){this.iconNode.setStyle("background-image","url("+"/x_component_Selector/$Selector/default/icon/departmenticon.png)")},loadSubItem:function(){this.isExpand=this.selector.options.expand;if(this.data.subDirectUnitCount){if(this.selector.options.expand){if(this.level===1){this.levelNode.setStyles(this.selector.css.selectorItemLevelNode_expand);this.loadSubItems()}else{this.isExpand=false;this.levelNode.setStyles(this.selector.css.selectorItemLevelNode_collapse)}}else{this.levelNode.setStyles(this.selector.css.selectorItemLevelNode_collapse)}this.levelNode.addEvent("click",function(t){if(this.isExpand){this.children.setStyle("display","none");this.levelNode.setStyles(this.selector.css.selectorItemLevelNode_collapse);this.isExpand=false}else{this.loadSubItems();this.levelNode.setStyles(this.selector.css.selectorItemLevelNode_expand);this.isExpand=true}t.stopPropagation()}.bind(this))}},loadSubItems:function(){if(!this.loaded){if(!this.children){this.children=new Element("div",{styles:this.selector.css.selectorItemCategoryChildrenNode}).inject(this.node,"after")}this.children.setStyle("display","block");this.data.woSubDirectUnitList.each(function(t){if(!this.selector.options.unitType||t.typeList.indexOf(this.selector.options.unitType)!==-1){var e=this.selector._newItem(t,this.selector,this.children,this.level+1)}else{if(data.woSubDirectUnitList.length)var i=this.selector._newItemCategory("ItemCategory",t,this.selector,this.children)}}.bind(this));this.loaded=true}else{this.children.setStyle("display","block")}}});MWF.xApplication.Selector.UnitWithType.SearchItem=new Class({Extends:MWF.xApplication.Selector.Unit.Item,_getShowName:function(){return this.data.levelName||this.data.name}});MWF.xApplication.Selector.UnitWithType.ItemSelected=new Class({Extends:MWF.xApplication.Selector.Unit.ItemSelected,_getTtiteText:function(){return this.data.levelName||this.data.name},_getShowName:function(){return this.data.name+(this.data.levelName?"("+this.data.levelName+")":"")},_setIcon:function(){this.iconNode.setStyle("background-image","url("+"/x_component_Selector/$Selector/default/icon/departmenticon.png)")}});MWF.xApplication.Selector.UnitWithType.ItemCategory=new Class({Extends:MWF.xApplication.Selector.Unit.ItemCategory,loadSub:function(t){if(!this.loaded){this.data.woSubDirectUnitList.each(function(t){if(!this.selector.options.unitType||t.typeList.indexOf(this.selector.options.unitType)!==-1){var e=this.selector._newItem(t,this.selector,this.children,this.level+1)}else{if(t.woSubDirectUnitList.length)var i=this.selector._newItemCategory("ItemCategory",t,this.selector,this.children,this.level+1)}}.bind(this));this.loaded=true;if(t)t()}else{if(t)t()}},_hasChild:function(){return this.data.woSubDirectUnitList.length}});MWF.xApplication.Selector.UnitWithType.Filter=new Class({Implements:[Options,Events],options:{style:"default",units:[]},initialize:function(t,e){this.setOptions(e);this.value=t;this.orgAction=MWF.Actions.get("x_organization_assemble_control")},filter:function(t,e){this.value=t;var i=this.value;i={key:i};if(this.options.units.length){var n=[];this.options.units.each(function(t){if(typeOf(t)==="string"){n.push(t)}if(typeOf(t)==="object"){n.push(t.distinguishedName)}});i.unitList=n}if(this.options.unitType)i.type=this.options.unitType;this.orgAction.listUnitByKey(function(t){data=t.data;if(e)e(data)}.bind(this),failure,i)}});