MWF.xApplication.portal.Portal.options.multitask=true;MWF.xApplication.portal.Portal.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"portal.Portal",icon:"icon.png",width:"1200",height:"800",title:MWF.xApplication.portal.Portal.LP.title,portalId:"",pageId:"",isControl:false,taskObject:null,readonly:false},onQueryLoad:function(){debugger;this.lp=MWF.xApplication.portal.Portal.LP;if(this.status){this.options.portalId=this.status.portalId;this.options.pageId=this.status.pageId}},loadApplication:function(t){this.node=new Element("div",{styles:this.css.content}).inject(this.content);this.formNode=new Element("div",{styles:{"min-height":"100%","font-size":"14px"}}).inject(this.node);this.action=MWF.Actions.get("x_portal_assemble_surface");if(!this.options.isRefresh){this.maxSize(function(){this.loadPortal()}.bind(this))}else{this.loadPortal()}if(t)t()},toPage:function(t,i){if(t){var o=layout.mobile?"getPageByNameMobile":"getPageByName";this.action[o](t,this.portal.id,function(t){var o=t.data.data?JSON.decode(MWF.decodeJsonString(t.data.data)):null;if(o){this.options.pageId=t.data.id;MWF.release(this.appForm);this.appForm=null;this.formNode.empty();this.page=o;this.openPortal(i)}}.bind(this))}else{if(this.options.pageId){var o=layout.mobile?"getPageByNameMobile":"getPageByName";this.action[o](this.options.pageId,this.portal.id,function(t){var o=t.data.data?JSON.decode(MWF.decodeJsonString(t.data.data)):null;if(o){this.options.pageId=t.data.id;MWF.release(this.appForm);this.appForm=null;this.formNode.empty();this.page=o;this.openPortal(i)}}.bind(this))}}},loadPortal:function(){this.action.getApplication(this.options.portalId,function(t){this.portal=t.data;this.setTitle(this.portal.name);if(!this.options.pageId)this.options.pageId=this.portal.firstPage;if(this.portal.icon){if(this.taskitem){this.taskitem.iconNode.setStyles({"background-image":"url(data:image/png;base64,"+this.portal.icon+")","background-size":"24px 24px"})}}debugger;var i=layout.mobile?"getPageMobile":"getPage";this.action[i](this.options.pageId,function(t){this.page=t.data.data?JSON.decode(MWF.decodeJsonString(t.data.data)):null;this.openPortal()}.bind(this))}.bind(this))},openPortal:function(t){debugger;if(this.page){MWF.xDesktop.requireApp("process.Xform","Form",function(){this.appForm=new MWF.APPForm(this.formNode,this.page,{macro:"PageContext",parameters:t});this.appForm.businessData={control:{allowSave:true},data:{}};this.appForm.workAction=this.action;this.appForm.app=this;this.appForm.load();if(this.mask)this.mask.hide()}.bind(this))}},recordStatus:function(){return{portalId:this.options.portalId,pageId:this.options.pageId}},onPostClose:function(){if(this.appForm){this.appForm.modules.each(function(t){MWF.release(t)});MWF.release(this.appForm)}}});