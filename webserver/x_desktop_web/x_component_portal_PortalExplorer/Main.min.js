MWF.xApplication.portal=MWF.xApplication.portal||{};MWF.xApplication.portal.PortalExplorer=MWF.xApplication.portal.PortalExplorer||{};MWF.xDesktop.requireApp("process.ApplicationExplorer","",null,false);MWF.xApplication.portal.PortalExplorer.Main=new Class({Extends:MWF.xApplication.process.ApplicationExplorer.Main,Implements:[Options,Events],options:{style:"default",name:"portal.PortalExplorer",icon:"icon.png",width:"1000",height:"600",title:MWF.PortalLP.title,tooltip:{cancel:MWF.PortalLP.application.action_cancel,ok:MWF.PortalLP.application.action_ok,create:MWF.PortalLP.application.create,search:MWF.PortalLP.application.search,searchText:MWF.PortalLP.application.searchText,allCategory:MWF.PortalLP.application.allCategory,unCategory:MWF.PortalLP.application.unCategory,selectCategory:MWF.PortalLP.application.selectCategory,nameLabel:MWF.PortalLP.application.name,aliasLabel:MWF.PortalLP.application.alias,descriptionLabel:MWF.PortalLP.application.description,typeLabel:MWF.PortalLP.application.type,iconLabel:MWF.PortalLP.application.icon,createApplication_cancel_title:MWF.PortalLP.application.createApplication_cancel_title,createApplication_cancel:MWF.PortalLP.application.createApplication_cancel,inputApplicationName:MWF.PortalLP.application.inputApplicationName,createApplicationSuccess:MWF.PortalLP.application.createApplicationSuccess,unDescription:MWF.PortalLP.application.unDescription,noPage:MWF.PortalLP.application.noPage,noApplication:MWF.PortalLP.application.noApplication,noApplicationCreate:MWF.PortalLP.application.noApplicationCreate,loadding:MWF.PortalLP.application.loadding}},onQueryLoad:function(){this.lp=MWF.PortalLP;this.currentContentNode=null},loadApplication:function(t){this.restActions=MWF.Actions.get("x_portal_assemble_designer");this.category=null;this.applications=[];this.deleteElements=[];this.createNode();this.loadApplicationContent();if(t)t()},loadApplicationByCategory:function(t){var i="";if(t){i=t.retrieve("categoryName","")}this.restActions.listApplicationSummary(i,function(t){this.applicationContentNode.empty();if(t.data.length){t.data.each(function(t){var i=new MWF.xApplication.portal.PortalExplorer.Portal(this,t);i.load();this.applications.push(i)}.bind(this))}else{if(MWF.AC.isProcessPlatformCreator()){var i=new Element("div",{styles:this.css.noApplicationNode,text:this.options.tooltip.noApplicationCreate}).inject(this.applicationContentNode);i.addEvent("click",function(){this.createApplication()}.bind(this))}else{var i=new Element("div",{styles:this.css.noApplicationNode,text:this.options.tooltip.noApplication}).inject(this.applicationContentNode)}}}.bind(this))},importApplication:function(t){MWF.xDesktop.requireApp("portal.PortalExplorer","Importer",function(){new MWF.xApplication.portal.PortalExplorer.Importer(this,t).load()}.bind(this))},okCreateApplication:function(t){var i={name:$("createApplicationName").get("value"),alias:$("createApplicationAlias").get("value"),description:$("createApplicationDescription").get("value"),portalCategory:$("createApplicationType").get("value")};if(i.name){this.restActions.saveApplication(i,function(t){this.applicationCreateMarkNode.destroy();this.applicationCreateAreaNode.destroy();this.restActions.getApplication(t.data.id,function(t){t.data.processList=[];t.data.formList=[];var i=new MWF.xApplication.portal.PortalExplorer.Portal(this,t.data,{where:"top"});i.load();this.applications.push(i)}.bind(this));this.notice(this.options.tooltip.createApplicationSuccess,"success")}.bind(this))}else{$("createApplicationName").setStyle("border-color","red");$("createApplicationName").focus();this.notice(this.options.tooltip.inputApplicationName,"error")}}});MWF.xApplication.portal.PortalExplorer.Portal=new Class({Extends:MWF.xApplication.process.ApplicationExplorer.Application,Implements:[Options,Events],options:{where:"bottom",bgColor:["#30afdc","#e9573e","#8dc153","#9d4a9c","#ab8465","#959801","#434343","#ffb400","#9e7698","#00a489"]},load:function(){this.node=new Element("div",{styles:this.css.applicationItemNode});this.loadTopNode();this.loadIconNode();this.loadDeleteAction();this.loadExportAction();this.loadTitleNode();this.loadNewNode();this.loadInforNode();this.loadPageNode();this.node.inject(this.container,this.options.where)},loadIconNode:function(){this.iconNode=new Element("div",{styles:this.css.applicationItemIconNode}).inject(this.topNode);if(this.data.icon){this.iconNode.setStyle("background-image","url(data:image/png;base64,"+this.data.icon+")")}else{this.iconNode.setStyle("background-image","url("+"/x_component_portal_PortalExplorer/$Main/default/icon/application.png)")}this.iconNode.makeLnk({par:this._getLnkPar()})},exportApplication:function(){MWF.xDesktop.requireApp("portal.PortalExplorer","Exporter",function(){new MWF.xApplication.portal.PortalExplorer.Exporter(this.app,this.data).load()}.bind(this))},_deleteElement:function(t,i,a){this.app.restActions.deleteApplication(t,i,a)},_getLnkPar:function(){var t="/x_component_portal_PortalExplorer/$Main/default/lnk.png";if(this.data.icon)t="data:image/png;base64,"+this.data.icon;var i="portal.PortalManager"+this.data.id;return{icon:t,title:this.data.name,par:'portal.PortalManager#{"application": "'+this.data.id+'", "appId": "'+i+'"}'}},loadPageNode:function(){this.pageNode=new Element("div",{styles:this.css.applicationItemElNode}).inject(this.inforNode);this.pageTitleNode=new Element("div",{styles:this.css.applicationItemElTitleNode,text:"页面"}).inject(this.inforNode);this.pageListNode=new Element("div",{styles:this.css.applicationItemElListNode}).inject(this.inforNode);this.loadPageList()},loadPageList:function(){if(this.data.pageList&&this.data.pageList.length){for(var t=0;t<8..min(this.data.pageList.length);t++){var i=this.data.pageList[t];var a=new Element("div",{styles:this.css.listItemNode,text:i.name}).inject(this.pageListNode);a.store("pageId",i.id);var e=this;a.addEvents({click:function(t){e.openPage(this,t)},mouseover:function(){this.setStyle("color","#3c5eed")},mouseout:function(){this.setStyle("color","#666")}})}}else{var o=new Element("div",{text:this.app.options.tooltip.noPage,styles:{cursor:"pointer","line-height":"30px"}}).inject(this.pageListNode);o.addEvent("click",function(t){this.createNewPage(t)}.bind(this))}},openPage:function(t,i){var a=t.retrieve("pageId");if(a){var e=this;var o={onQueryLoad:function(){this.actions=e.app.actions;this.options.id=a;this.application=e.data}};this.app.desktop.openApplication(i,"portal.PageDesigner",o)}},openApplication:function(t,i){var a="portal.PortalManager"+this.data.id;if(this.app.desktop.apps[a]){this.app.desktop.apps[a].setCurrent()}else{this.app.desktop.openApplication(t,"portal.PortalManager",{application:this.data,appId:a,onQueryLoad:function(){this.status={navi:i||null}}})}},loadDateNode:function(){this.dateNode=new Element("div",{styles:this.css.applicationItemDateNode,text:this.data.updateTime}).inject(this.inforNode)}});