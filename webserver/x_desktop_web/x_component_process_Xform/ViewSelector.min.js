MWF.xDesktop.requireApp("process.Xform","$Module",null,false);MWF.xApplication.process.Xform.ViewSelector=MWF.APPViewSelector=new Class({Implements:[Events],Extends:MWF.xApplication.process.Xform.Button,_loadUserInterface:function(){var t=new Element("button");t.inject(this.node,"after");this.node.destroy();this.node=t;this.node.set({id:this.json.id,text:this.json.name||this.json.id,styles:this.form.css.buttonStyles,MWFType:this.json.type});this.node.addEvent("click",function(){this.selectedData=null;this.selectView(function(t){this.doResult(t)}.bind(this))}.bind(this))},doResult:function(o){if(this.json.result==="script"){this.selectedData=o;return this.json.selectedScript.code?this.form.Macro.exec(this.json.selectedScript.code,this):""}else{Object.each(this.json.selectedSetValues,function(i,t){var s="";o.each(function(t,e){Object.each(t.data,function(t,e){if(e===i)s=s?s+", "+t:t}.bind(this))}.bind(this));var e=this.form.all[t];if(e){e.setData(s);if(s){if(e.descriptionNode)e.descriptionNode.setStyle("display","none")}else{if(e.descriptionNode)e.descriptionNode.setStyle("display","block")}}}.bind(this))}},selectCMSView:function(s){var t=this.json.cmsViewName;if(t){var e=null;if(this.json.filterList&&this.json.filterList.length){e=[];this.json.filterList.each(function(t){t.value=this.form.Macro.exec(t.code.code,this);e.push(t)}.bind(this))}var o={application:t.appId,viewName:t.name,isTitle:this.json.isTitle||"yes",select:this.json.select||"single",titleStyles:this.json.titleStyles,itemStyles:this.json.itemStyles,isExpand:this.json.isExpand||"no",filter:e};var n={};var l=n.width||"800";var c=n.height||"450";var i;if(layout.mobile){i=document.body.getSize();l=i.x;c=i.y;n.style="viewmobile"}l=l.toInt();c=c.toInt();i=this.form.app.content.getSize();var a=(i.x-l)/2;var r=(i.y-c)/2;if(a<0)a=0;if(r<0)r=0;if(layout.mobile){a=20;r=0}var h=this;MWF.require("MWF.xDesktop.Dialog",function(){var e=new MWF.xDesktop.Dialog({title:this.json.title||"select view",style:n.style||"view",top:r,left:a-20,fromTop:r,fromLeft:a-20,width:l,height:c,html:"<div></div>",maskNode:this.form.app.content,container:this.form.app.content,buttonList:[{text:MWF.LP.process.button.ok,action:function(){if(s)s(h.view.getData());this.close()}},{text:MWF.LP.process.button.cancel,action:function(){this.close()}}]});e.show();if(layout.mobile){var t=e.node.getElement(".MWF_dialod_Action_back");var i=e.node.getElement(".MWF_dialod_Action_ok");if(t)t.addEvent("click",function(t){e.close()}.bind(this));if(i)i.addEvent("click",function(t){if(s)s(this.view.getData());e.close()}.bind(this))}MWF.xDesktop.requireApp("process.Application","Viewer",function(){this.view=new MWF.xApplication.process.Application.Viewer(e.content,o,{actions:{lookup:{uri:"/jaxrs/queryview/flag/{view}/application/flag/{application}/execute",method:"PUT"},getView:{uri:"/jaxrs/queryview/flag/{view}/application/flag/{application}"}},actionRoot:"x_cms_assemble_control"})}.bind(this))}.bind(this))}},selectProcessView:function(s){debugger;var t=this.json.processViewName;if(t){var e=null;if(this.json.filterList&&this.json.filterList.length){e=[];this.json.filterList.each(function(t){t.value=this.form.Macro.exec(t.code.code,this);e.push(t)}.bind(this))}var o={application:t.application,viewName:t.name,isTitle:this.json.isTitle||"yes",select:this.json.select||"single",titleStyles:this.json.titleStyles,itemStyles:this.json.itemStyles,isExpand:this.json.isExpand||"no",filter:e};var n={};var l=n.width||"800";var c=n.height||"600";var i;if(layout.mobile){i=document.body.getSize();l=i.x;c=i.y;n.style="viewmobile"}l=l.toInt();c=c.toInt();i=this.form.app.content.getSize();var a=(i.x-l)/2;var r=(i.y-c)/2;if(a<0)a=0;if(r<0)r=0;if(layout.mobile){a=20;r=0}var h=this;MWF.require("MWF.xDesktop.Dialog",function(){var e=new MWF.xDesktop.Dialog({title:this.json.title||"select view",style:n.style||"view",top:r,left:a-20,fromTop:r,fromLeft:a-20,width:l,height:c,html:"",maskNode:this.form.app.content,container:this.form.app.content,buttonList:[{text:MWF.LP.process.button.ok,action:function(){if(s)s(h.view.getData());this.close()}},{text:MWF.LP.process.button.cancel,action:function(){this.close()}}]});e.show();if(layout.mobile){var t=e.node.getElement(".MWF_dialod_Action_back");var i=e.node.getElement(".MWF_dialod_Action_ok");if(t)t.addEvent("click",function(t){e.close()}.bind(this));if(i)i.addEvent("click",function(t){if(s)s(this.view.getData());e.close()}.bind(this))}MWF.xDesktop.requireApp("process.Application","Viewer",function(){this.view=new MWF.xApplication.process.Application.Viewer(e.content,o)}.bind(this))}.bind(this))}},selectQueryView:function(s){var t=this.json.queryView;if(t){var e=null;if(this.json.filterList&&this.json.filterList.length){e=[];this.json.filterList.each(function(t){t.value=this.form.Macro.exec(t.code.code,this);e.push(t)}.bind(this))}var o={application:t.appName,viewName:t.name,isTitle:this.json.isTitle||"yes",select:this.json.select||"single",titleStyles:this.json.titleStyles,itemStyles:this.json.itemStyles,isExpand:this.json.isExpand||"no",filter:e};var n={};var l=n.width||"800";var c=n.height||"450";if(layout.mobile){var i=document.body.getSize();l=i.x;c=i.y;n.style="viewmobile"}l=l.toInt();c=c.toInt();var i=this.form.app.content.getSize();var a=(i.x-l)/2;var r=(i.y-c)/2;if(a<0)a=0;if(r<0)r=0;if(layout.mobile){a=20;r=0}var h=this;MWF.require("MWF.xDesktop.Dialog",function(){var e=new MWF.xDesktop.Dialog({title:this.json.title||"select view",style:n.style||"view",top:r,left:a-20,fromTop:r,fromLeft:a-20,width:l,height:c,html:"",maskNode:this.form.app.content,container:this.form.app.content,buttonList:[{text:MWF.LP.process.button.ok,action:function(){if(s)s(h.view.getData());this.close()}},{text:MWF.LP.process.button.cancel,action:function(){this.close()}}]});e.show();if(layout.mobile){var t=e.node.getElement(".MWF_dialod_Action_back");var i=e.node.getElement(".MWF_dialod_Action_ok");if(t)t.addEvent("click",function(t){e.close()}.bind(this));if(i)i.addEvent("click",function(t){if(s)s(this.view.getData());e.close()}.bind(this))}MWF.xDesktop.requireApp("query.Query","Viewer",function(){this.view=new MWF.xApplication.query.Query.Viewer(e.content,o)}.bind(this))}.bind(this))}},selectView:function(t){debugger;if(this.json.queryView){this.selectQueryView(t)}else{if(this.json.selectViewType==="cms"){this.selectCMSView(t)}else{this.selectProcessView(t)}}}});