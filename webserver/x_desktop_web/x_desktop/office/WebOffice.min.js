function WebOffice2015(){this.dVersion="2.16.1.1";this.dUpdateDate="2016-1-1";this.FileType="";this.obj;this.Status="";this.ShowDialog={DialogNew:0,DialogOpen:1,DialogSaveAs:2,DialogSaveCopyAs:3,DialogPrint:4,DialogPageSetup:5,DialogProperties:6};this.FileName="";this.EditType=0;this.UserName="";this.setObj=function(t){this.obj=t;this.WebObject=this.obj};this.DocType={WOED:0,EXECL:1};this.HttpMethod={Get:0,Post:1};this.DOWN="\\WebOffice\\Down\\";this.UP="\\WebOffice\\UP\\";this.FilePath=null;this.tempInsertName="";this.DocTypeValue={DOC:0,DOCX:16,XLS:56,XLSX:51};this.DocSuffixType={0:".doc",12:".docx",56:".xls",51:".xlsx"};this.setVersion=-1;this.OfficeVersion={v2003:1,vOther:0};this.WebObject=null;this.sendMode=null;this.iWebOfficeTempName="iWebOfficeTempName.doc";this.Caption="DEMO演示平台";this.SetCaption=function(){this.Caption='"'+this.UserName+'"正在编辑文档';this.obj.Caption=this.Caption};this.Caption="DEMO演示平台";this.SetCaption=function(){this.Caption='"'+this.UserName+'"正在编辑文档';this.obj.Caption=this.Caption};this.SetUser=function(t){this.obj.User=t};this.CreateFile=function(){var t=this.getDocType(this.FileType);switch(t){case this.DocType.WOED:this.obj.CreateNew("Word.Document");break;case this.DocType.EXECL:this.obj.CreateNew("Excel.Sheet");break;default:this.obj.CreateNew("Word.Document");break}};this.getDocType=function(t){if(t==".doc"||t==".docx"||t==".wps"){return this.DocType.WOED}if(t==".xls"||t==".xlsx"||t==".et"){return this.DocType.EXECL}};this.HookEnabled=function(){if(this.getDocType(this.FileType)==this.DocType.WOED){this.obj.Style.ShowToolSpace=true;this.obj.SelectionInformationEnabled=false}if(!(window.ActiveXObject!=undefined||window.ActiveXObject!=null||"ActiveXObject"in window)){this.obj.HookEnabled=false}};this.WebOpenLocal=function(){this.setShowDialog(this.ShowDialog.DialogOpen,this.getOpenDocSuffix(this.FileType))};this.getOpenDocSuffix=function(t){if(t.length==5){t=t.substring(0,4)}var e;e="";if(this.isWPS()||!this.getOfficeVersion()){e+="*"+t+"x|*"+t+"x|"}e+="*"+t+"|*"+t+"|";e+=this.getOpenSuffixName(t)+"(*"+t;if(this.isWPS()||!this.getOfficeVersion()){e+=";*"+t+"x"}e+=")|*"+t;if(this.isWPS()||!this.getOfficeVersion()){e+=";*"+t+"x"}e+="|";return e};this.getEditVersion=function(){return this.obj.AppName};this.getOpenSuffixName=function(t){var e;switch(t){case this.DocType.WOED:e="Word Files";break;case this.DocType.EXECL:e="Excel Files";break;default:e="Word Files";break}return e};this.setShowDialog=function(t,e){switch(t){case this.ShowDialog.DialogOpen:this.obj.ShowDialog(t,e,0);break;case this.ShowDialog.DialogNew:case this.ShowDialog.DialogPageSetup:case this.ShowDialog.DialogPrint:case this.ShowDialog.DialogProperties:case this.ShowDialog.DialogSaveCopyAs:case this.ShowDialog.DialogSaveAs:this.blnIE()?this.obj.ShowDialog(t):this.obj.ExecuteScript(t+"","ActiveObject.ShowDialog("+t+")");break;default:;break}};this.WebSaveLocal=function(){this.setShowDialog(this.ShowDialog.DialogSaveCopyAs)};this.WebPageSetup=function(){this.setShowDialog(this.ShowDialog.DialogPageSetup)};this.WebOpenPrint=function(){this.setShowDialog(this.ShowDialog.DialogPrint)};this.WebClose=function(){if(navigator.userAgent.indexOf("Firefox")>=0){return}this.Close()};this.PrintPreview=function(){this.obj.PrintPreview()};this.PrintPreviewExit=function(){this.obj.PrintPreviewExit()};var MenuFile;this.AppendMenu=function(t,e){var i=this.obj.CustomMenu;if(MenuFile==undefined||MenuFile==null){i.Clear();MenuFile=i.CreatePopupMenu();i.Add(MenuFile,"文件(&F)")}i.AppendMenu(MenuFile,t,false,e);i.Update()};this.AddCustomMenu=function(){var t=this.obj.CustomMenu;var e=t.CreatePopupMenu();var i=t.CreatePopupMenu();t.AppendMenu(i,6,false,"自定义二级菜单一");t.AppendMenu(i,7,false,"自定义二级菜单二");t.AppendMenu(i,0,false,"-");var s=t.CreatePopupMenu();t.AppendMenu(s,8,false,"自定义三级菜单一");t.AppendMenu(s,0,false,"-");t.AppendMenu(s,9,false,"自定义三级菜单二");t.AppendMenu(i,s,true,"自定义三级菜单");t.AppendMenu(i,10,false,"自定义二级菜单三");t.AppendMenu(e,i,true,"自定义二级菜单");t.AppendMenu(e,17,false,"启用保存");t.AppendMenu(e,18,false,"禁止保存");t.AppendMenu(e,0,false,"-");t.AppendMenu(e,19,false,"启用打印");t.AppendMenu(e,20,false,"禁止打印");t.Add(e,"编辑(&E)");t.Update()};this.WebOpen=function(t){var e=this.obj.Http;e.Clear();this.WebSetMsgByName("USERNAME",this.UserName);this.WebSetMsgByName("FILENAME",this.FileName);this.WebSetMsgByName("FILETYPE",this.FileType);this.WebSetMsgByName("RECORDID",this.RecordID);this.WebSetMsgByName("OPTION","LOADFILE");e.AddForm("FormData",this.WebSendMessage());this.WebClearMessage();if(this.LOADFILE(e)){this.Status="打开文档成功";return true}this.Status="打开文档失败";return false};this.WebSaveLocalFile=function(t){this.Save(t,this.getOfficeVersion(),this.FileType.substring(1).toUpperCase())};this.Save=function(FileName,is2003,FileType){if(is2003){this.obj.Save(FileName);return}this.obj.Save(FileName,eval("this.DocTypeValue."+FileType),true)};this.WebSave=function(){var t=this.obj.Http;t.Clear();this.WebSetMsgByName("USERNAME",this.UserName);this.WebSetMsgByName("RECORDID",this.RecordID);this.WebSetMsgByName("OPTION","SAVEFILE");this.WebSetMsgByName("FILENAME",this.FileName);this.WebSaveLocalFile(this.getFilePath()+this.FileName);this.Close();if(this.SAVEFILE(t,this.FilePath+this.FileName)){this.Status="保存文件成功";return true}this.Status="保存文件失败";return false};this.SAVEFILE=function(t,e){t.AddForm("FormData",this.WebSendMessage());t.AddFile("FileData",e);this.WebClearMessage();t.ShowProgressUI=false;if(t.Open(this.HttpMethod.Post,this.WebUrl,false)){if(!t.Send()){if(t.Status==0){if(!t.Send()){return false}}}t.Clear();return true}return false};this.LOADFILE=function(t){t.ShowProgressUI=true;if(t.Open(this.HttpMethod.Post,this.WebUrl,false)){if(t.Send()){if(t.GetResponseHeader("MsgError")=="404"){this.CreateFile();this.getOfficeVersion();t.Clear();return true}t.Clear();if(this.hiddenSaveLocal(t,this,false,false)){if(this.OpenLocalFile(this.FilePath+this.FileName)==0){this.getOfficeVersion();return true}else{var e=window.confirm("打开文档错误，可能当前编辑软件不支持当前格式！\r\r单击“确定”关闭。单击“取消”继续。");if(e==1){window.close()}return false}}}return false}};this.getFilePath=function(){var t=this.obj.FileSystem;var e=t.GetSpecialFolderPath(26)+this.UP;t.CreateDirectory(e);this.FilePath=e;return this.FilePath};this.OpenLocalFile=function(t){return this.obj.Open(t)};this.hiddenSaveLocal=function(t,e,i,s,o){if(i){t.Hidden=true}var n="";var a=e.obj.FileSystem;var r=a.GetSpecialFolderPath(26)+e.DOWN;a.CreateDirectory(r);e.FilePath=r;if(t.Status==200){if(s==undefined||s==true){n="temp"+e.RecordID;e.tempInsertName=n+e.FileName}if(o==undefined||o==""){o=e.FileName}t.ResponseSaveToFile(r+n+o);t.Clear();return true}t.Clear();return false};this.getOfficeVersion=function(){var t=0;try{if(this.setVersion==-1){t=parseFloat(this.obj.ActiveDocument.Application.Version);this.setVersion=t}else{t=this.setVersion}if(t==11){return this.OfficeVersion.v2003}else{return this.OfficeVersion.vOther}}catch(t){return this.OfficeVersion.v2003}};this.Close=function(){this.obj.Close()};this.Activate=function(t){this.obj.Activate(t)};this.WebPageCode=function(){var t="ActiveObject.ActiveDocument.Application.Dialogs(294).Show()";this.blnIE()?this.obj.ActiveDocument.Application.Dialogs(294).Show():this.ExecuteScript("WebPageCode",t)};this.ExecuteScript=function(t,e){this.obj.ExecuteScript(t,e)};this.ShowTitleBar=function(t){var e=this.obj.Style;e.ShowTitleBar=t};this.ShowMenuBar=function(t){var e=this.obj.Style;e.ShowMenuBar=t};this.ShowToolBars=function(t){var e=this.obj.Style;e.ShowToolBars=t};this.ShowStatusBar=function(t){var e=this.obj.Style;e.ShowStatusBar=t};this.FullSize=function(t){this.obj.FullSize=t};this.WebShow=function(t){if(this.getDocType(this.FileType)==this.DocType.WOED){this.VBAShowRevisions(t)}};this.SaveEnabled=function(t){this.obj.SaveEnabled=t};this.PrintEnabled=function(t){this.obj.PrintEnabled=t};this.WebSetProtect=function(t,e){var i=this.getDocType(this.FileType);if(e==""){e="123456"}t?this.VBAProtectDocument(i,e):this.VBAUnProtectDocument(i,e)};this.WebSetBookmarks=function(t,e){this.VBASetBookmarks(t,e)};this.WebOpenBookMarks=function(){var t="ActiveObject.ActiveDocument.Application.Dialogs(168).Show()";this.blnIE()?this.obj.ActiveDocument.Application.Dialogs(168).Show():this.ExecuteScript("WebPageCode",t)};this.WebAddBookMarks=function(t,e){if(!this.obj.ActiveDocument.BookMarks.Exists(t)){var i=e.length;this.obj.ActiveDocument.Application.Selection.TypeText(e);this.obj.ActiveDocument.Application.Selection.MoveLeft(Unit=1,Count=i);var s=this.obj.ActiveDocument.Application.Selection.Start;var o=this.obj.ActiveDocument.Application.Selection.Start+i;this.obj.ActiveDocument.Range(Start=s,End=o).Select();this.obj.ActiveDocument.Bookmarks.Add(t)}};this.WebFindBookMarks=function(t){var e=this.obj.Range;e=this.obj.ActiveDocument.Bookmarks(t).Range;e.Select()};this.WebDelBookMarks=function(t){if(this.obj.ActiveDocument.BookMarks.Exists(t)){this.obj.ActiveDocument.Bookmarks(t).Delete()}};this.WebGetDocSuffix=function(){try{var t=this.getDocType(this.FileType);var e=0;if(t==this.DocType.WOED){this.Activate(true);e=this.obj.ActiveDocument.SaveFormat}if(t==this.DocType.EXECL){this.obj.ExitExcelEditMode();e=this.obj.ActiveDocument.FileFormat;if(e<0){e=56}}return this.DocSuffixType[e]}catch(t){return this.FileType}};this.WebFullName=function(){return this.obj.FullName};this.BookMark="";this.ImageName="";this.WebInsertImage=function(t,e){var i=this.obj.Http;this.sendMode="LoadImage";this.BookMark=t;this.ImageName=e;var s=this.WebUrl.substring(0,this.WebUrl.lastIndexOf("/"));i.ShowProgressUI=false;if(i.Open(this.HttpMethod.Post,s+"/Document/"+e,true)){i.Send();i.Clear()}};this.InsertImageByBookMark=function(){if(this.BookMark==null||this.BookMark=="null"||this.BookMark==""){this.obj.ActiveDocument.Application.Selection.GoTo(-1,0,0,this.BookMark)}this.obj.ActiveDocument.Application.Selection.InlineShapes.AddPicture(this.FilePath+this.ImageName);this.obj.ActiveDocument.InlineShapes.Item(1).ConvertToShape();this.obj.ActiveDocument.Shapes.Item(1).WrapFormat.Type=5;return true};this.WebInsertFile=function(){var t=this.obj.Http;this.WebSetMsgByName("FILENAME",this.FileName);this.WebSetMsgByName("OPTION","LOADFILE");t.AddForm("FormData",this.WebSendMessage());this.WebClearMessage();if(this.LOADFILE(t)){this.Status="打开文档成功";return true}this.Status="打开文档失败";return false};this.DownloadToFile=function(t,e){var i=this.obj.Http;var s=this.WebUrl.substring(0,this.WebUrl.lastIndexOf("/"));i.ShowProgressUI=false;if(i.Open(this.HttpMethod.Get,s+"/Document/"+t,false)){if(i.Send()){if(i.Status==200){i.ResponseSaveToFile(e+t);i.Clear();return true}}}i.Close();return false};this.ArrayList=function(){this.ObjArr={};this.Count=0;this.Add=function(t,e){this.ObjArr[t]=e;this.Count++;return true};this.Clear=function(){this.ObjArr={};this.Count=0};this.toString=function(){var t=new Array;var e=0;for(var e in this.ObjArr){t.push("'"+e+"':'"+this.ObjArr[e]+"'")}return"{"+t+"}"}};this.ht=new this.ArrayList;this.WebSetMsgByName=function(t,e){this.ht.Add(t,e)};this.WebSendMessage=function(){return this.ht.toString()};this.WebClearMessage=function(){this.ht.Clear()};this.blnIE=function(){return window.ActiveXObject!=undefined||window.ActiveXObject!=null||"ActiveXObject"in window};this.isWPS=function(){return this.FileType.toUpperCase()==".WPS"||this.FileType.toUpperCase()==".ET"};this.Version=function(){return this.obj.Version};this.WebEnableCopy=function(t){switch(t){case 0:case false:case"0":this.obj.CopyEnabled=false;break;case 1:case"1":case true:this.obj.CopyEnabled=true;break;default:;return}};this.WebDelFile=function(t){var e=this.obj.FileSystem;e.DeleteFile(t)};this.setEditType=function(t){try{switch(t){case"0":this.VBAProtectDocument(this.getDocType(this.FileType),"123");break;case"1":this.WebShow(false);break;case"2":this.WebShow(true);break;default:;}}catch(t){return false}};this.VBAShowRevisions=function(t){if(this.getDocType(this.FileType)==this.DocType.WOED&&this.obj.ActiveDocument.ProtectionType=="-1"){this.obj.ActiveDocument.TrackRevisions=t;this.obj.ActiveDocument.ShowRevisions=t;return true}return false};this.VBAProtectDocument=function(t,e){if(t==this.DocType.WOED){if(this.obj.ActiveDocument.ProtectionType=="-1"){this.obj.ActiveDocument.Protect(3,false,e);return}}if(t==this.DocType.EXECL){if(!this.obj.ActiveDocument.Application.Sheets(1).ProtectContents){this.obj.ActiveDocument.Application.Sheets(1).Protect(e)}return}return false};this.VBAUnProtectDocument=function(t,e){if(t==this.DocType.WOED){this.obj.ActiveDocument.Unprotect(e);return}if(t==this.DocType.EXECL){this.obj.ActiveDocument.Application.Sheets(1).Unprotect(e);return}};this.VBASetBookmarks=function(t,e){try{this.obj.ActiveDocument.Bookmarks(BookMarkName).Range.Text=BookMarkValue}catch(t){return false}};this.VBAInsertFile=function(t,e){try{this.obj.ActiveDocument.Application.Selection.GoTo(-1,0,0,t);this.obj.Activate(true);this.obj.ActiveDocument.Application.Selection.InsertFile(e,"",false,false,false);return true}catch(t){return false}};this.WebAcceptAllRevisions=function(){try{this.obj.Activate(true);this.obj.ActiveDocument.Revisions.AcceptAll();return this.obj.ActiveDocument.Revisions.Count>=0?true:false}catch(t){return false}};this.VBASetUserName=function(t){try{this.obj.ActiveDocument.Application.UserName=t}catch(t){return false}};this.ShowField=function(){try{this.obj.ActiveDocument.ActiveWindow.View.ShowDrawings=true;this.obj.ActiveDocument.ActiveWindow.View.ShowFieldCodes=true}catch(t){return false}};this.WebAreaProtect=function(t){if(!this.obj.ActiveDocument.BookMarks.Exists(t)){alert("文件内没有名称为'"+t+"'的书签 ,请先添加书签!");return}var e=this.obj.Range;e=this.obj.ActiveDocument.Bookmarks(t).Range;e.Select();this.obj.ActiveDocument.bookmarks(t).range.editors.add(-1);this.obj.ActiveDocument.Protect(3,false,"123",false,false);this.obj.ActiveDocument.Application.Selection.MoveLeft(Unit=1,Count=1);this.obj.ActiveDocument.ActiveWindow.View.ShadeEditableRanges=false};this.WebAreaUnprotect=function(t){if(this.obj.ActiveDocument.BookMarks.Exists(t)){try{this.obj.ActiveDocument.Unprotect("123");var e=this.obj.Range;e=this.obj.ActiveDocument.Bookmarks(t).Range;e.Select();this.obj.ActiveDocument.DeleteAllEditableRanges(-1)}catch(t){}}else{alert("不存在该书签!");return}};this.Skin=function(t){switch(t){case"purple":this.setColor("purple");this.Status="set pink success";break;case"black":this.setColor("black");this.Status="set black success";break;case"white":this.setColor("white");this.Status="set black success";break;case"blue":this.setColor("blue");this.Status="set black success";break;case"yellow":this.setColor("yellow");this.Status="set black success";break}};this.setColor=function(t){var e;var i;var s;var o;var n;var a;switch(t){case"purple":e=13408716;a=13408716;i=13408716;s=16777215;o=11373997;n=6697830;break;case"black":e=6579300;a=6579300;i=12039604;s=15919861;o=15919861;n=15919861;break;case"white":e=13025726;a=13025726;i=16118770;s=15919861;o=15919861;n=15919861;break;case"blue":e=14005919;a=14005919;i=16577519;s=15919861;o=15919861;n=15919861;break;case"yellow":e=52479;a=52479;i=6994431;s=15919861;o=15919861;n=15919861;break}var r=this.obj.Style;r.TitleBarColor=e;r.TitleBarTextColor=0;r.MenuBarStartColor=i;r.MenuBarEndColor=16777215;r.MenuBarTextColor=0;r.MenuBarHighlightTextColor=0;r.MenuBarButtonStartColor=s;r.MenuBarButtonEndColor=o;r.MenuBarButtonFrameColor=n;r.CustomToolbarStartColor=a;r.Invalidate()};this.AddToolbar=function(){this.obj.Handwritting.Show=!this.obj.Handwritting.Show;var t=this.WebUrl.substring(0,this.WebUrl.lastIndexOf("/"));var e=this.obj.CustomToolbar;e.AddToolButton(301,"手写签名",t+"/HandWrite/"+"shouxie24.png","手写签名",0);e.AddToolButton(302,"停止手写",t+"/HandWrite/"+"tingzhi24.png","停止手写",0);e.AddToolButton(303,"文字签名",t+"/HandWrite/"+"wenzi24.png","文字签名",0);e.AddToolButton(300,"-","","",1);e.AddToolButton(304,"图形签名",t+"/HandWrite/"+"tuxing24.png","图形签名",0);e.AddToolButton(305,"取消上一个签批",t+"/HandWrite/"+"quxiao24.png","取消上一个签批",0);e.AddToolButton(306,"显示用户签批",t+"/HandWrite/"+"xianshi24.png","显示用户签批",0)};this.HandWriting=function(t,e){var i=this.obj.Handwritting;var s=i.DrawingSetting;s.PenThicker=e;s.PenColor=t;i.AnnotateDraw();this.ShowMenuBar(false);this.ShowToolBars(false)};this.StopHandWriting=function(){var t=this.obj.Handwritting;t.StopAnnotate();WebOffice.ShowMenuBar(true);WebOffice.ShowToolBars(true)};this.TextWriting=function(){var t=this.obj.Handwritting;var e=t.TextSetting;e.TextSize=32;e.TextColor=12255487;e.FontName="宋体";t.AnnotateText();this.ShowMenuBar(false);this.ShowToolBars(false)};this.ShapeWriting=function(){var t=this.obj.Handwritting;var e=t.ShapeSetting;e.ShapeType=0;e.BackgroundColor=16777215;e.BorderColor=16711680;e.BorderWidth=6;t.AnnotateShape();this.ShowMenuBar(false);this.ShowToolBars(false)};this.RemoveLastWriting=function(){var t=this.obj.Handwritting;t.RemoveLast()};this.ShowWritingUser=function(bVal,username){var strxml=this.obj.GetAnnotations();var json=eval("("+strxml+")");if(username!=""&&username!=null&&username!=undefined){for(var i=0;i<json.Annotations.length;i++){if(json.Annotations[i].Annotation.User!=username){var id=json.Annotations[i].Annotation.ID;this.obj.GetAnnotationByID(id).Visible=bVal}}}else{for(var i=0;i<json.Annotations.length;i++){var id=json.Annotations[i].Annotation.ID;this.obj.GetAnnotationByID(id).Visible=bVal}}};this.ShowCustomToolbar=function(t){this.obj.Style.ShowCustomToolbar=t};this.WebSavePDF=function(){var t=this.obj.Http;t.Clear();this.WebSetMsgByName("RECORDID",this.RecordID);this.WebSetMsgByName("OPTION","SAVEPDF");this.WebSetMsgByName("FILENAME",this.RecordID+".pdf");this.SaveAsPdf(this.getFilePath()+this.RecordID+".pdf");if(this.SAVEFILE(t,this.getFilePath()+this.RecordID+".pdf")){this.Status="保存文件成功";alert("保存PDF成功!");return true}this.Status="保存文件失败";return false};this.SaveAsPdf=function(t){if(this.FileType==".doc"||this.FileType==".docx"||this.FileType==".wps"){try{this.obj.ActiveDocument.ExportAsFixedFormat(t,17,false,0,0,1,1,0,true,true,0,true,true,true)}catch(t){return this.e.description}return true}};this.SaveAsHtml=function(t){if(this.FileType==".doc"||this.FileType==".docx"||this.FileType==".wps"){try{var e=this.obj.ActiveDocument.SaveAs(t,8,false,"",false,"",false,false,false,false,false,0);this.obj.ActiveDocument.Application.ActiveWindow.View.type=3}catch(t){return this.e.description}return true}};this.WebSaveHtml=function(){if(this.SaveAsHtml("D:\\"+this.RecordID+".html")){alert("保存Html成功!\n保存路径:  "+"D:\\"+this.RecordID+".html")}};this.WebRunMacro=function(t,e){try{var i=e;var s;s=this.obj.ActiveDocument.VBProject.VBComponents.Add(1);s.CodeModule.AddFromString(i);this.obj.ActiveDocument.Application.Run(t);return true}catch(t){return false}}}