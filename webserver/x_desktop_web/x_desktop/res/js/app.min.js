layout=window.layout||{};var locate=window.location;layout.protocol=locate.protocol;var href=locate.href;if(href.indexOf("debugger")!=-1)layout["debugger"]=true;layout.session=layout.session||{};var uri=new URI(href);var appNames=uri.getData("app");var optionsStr=uri.getData("option");var statusStr=uri.getData("status");var options=optionsStr?JSON.decode(optionsStr):null;var statusObj=statusStr?JSON.decode(statusStr):null;layout.desktop=layout;COMMON.DOM.addReady(function(){COMMON.AjaxModule.load("/x_desktop/res/framework/mootools/plugin/mBox.Notice.js",null,false);COMMON.AjaxModule.load("/x_desktop/res/framework/mootools/plugin/mBox.Tooltip.js",null,false);COMMON.setContentPath("/x_desktop");COMMON.AjaxModule.load("mwf",function(){MWF.defaultPath="/x_desktop"+MWF.defaultPath;MWF.loadLP("zh-cn");MWF.require("MWF.xDesktop.Layout",function(){MWF.require("MWF.xDesktop.Authentication",null,false);MWF.xDesktop.requireApp("Common","",null,false);(function(){layout.requireApp=function(o,t,e){var a=o.split(".");var n=a[a.length-1];var i="MWF.xApplication."+o;var s=e||"Main";var p=i+"."+s;var u=i+".lp."+MWF.language;var r=MWF.xApplication;a.each(function(o,t){if(t<a.length-1){r[o]=r[o]||{}}else{r[o]=r[o]||{options:Object.clone(MWF.xApplication.Common.options)}}r=r[o]}.bind(this));if(!r.options)r.options=Object.clone(MWF.xApplication.Common.options);MWF.xDesktop.requireApp(o,"lp."+MWF.language,{onRequestFailure:function(){MWF.xDesktop.requireApp(o,"lp.zh-cn",null,false)}.bind(this),onSuccess:function(){}.bind(this)},false);MWF.xDesktop.requireApp(o,e,function(){if(t)t(r)})};layout.refreshApp=function(o){var t=o.recordStatus();var e=window.opener;if(e){e.layout.desktop.openBrowserStatus=t;var a=e.layout.desktop.openBrowserApp||appNames;var n=t;var i=e.layout.desktop.openBrowserOption||options;window.location.reload()}else{statusStr=JSON.encode(t);var s=uri.get("port");var p=uri.get("scheme")+"://"+uri.get("host")+(s?":"+s+"/":"")+uri.get("directory ")+"?app="+appNames+"&status="+statusStr;window.location=p}};layout.openApplication=function(t,o,e,a){if(layout.app){layout.desktop.openBrowserApp=o;layout.desktop.openBrowserStatus=a;layout.desktop.openBrowserOption=e;return window.open("app.html","_blank")}else{var n=o.split(".");var i=n[n.length-1];layout.requireApp(o,function(o){this.createNewApplication(t,o,i,e,a)}.bind(this))}};layout.createNewApplication=function(o,t,e,a,n){var i=new t["Main"](this,a);i.desktop=layout;i.inBrowser=true;i.status=n;i.load(true);var s=e;if(a.appId){s=a.appId}else{if(t.options.multitask)s=s+"-"+new MWF.widget.UUID}i.appId=s;layout.app=i};layout.load=function(){debugger;this.isAuthentication(function(){MWF.require("MWF.xDesktop.MessageMobile",function(){layout.message=new MWF.xDesktop.MessageMobile;layout.message.load()}.bind(this));layout.apps=[];this.node=$("layout");var o=window.opener;if(o){var t=o.layout.desktop.openBrowserApp||appNames;var e=o.layout.desktop.openBrowserStatus||statusObj;var a=o.layout.desktop.openBrowserOption||options;layout.openApplication(null,t,a||{},e)}else{var t=appNames;var e=statusObj;var a=options;layout.openApplication(null,t,a||{},e)}}.bind(this))};layout.isAuthentication=function(t){this.authentication=new MWF.xDesktop.Authentication({onLogin:layout.load.bind(layout)});var o=true;this.authentication.isAuthenticated(function(o){this.user=o.data;this.session={};this.session.user=o.data;if(t)t()}.bind(this),function(){this.authentication.loadLogin(document.body);o=false}.bind(this));return o};MWF.getJSON("res/config/config.json",function(o){layout.config=o;if(layout.config.app_protocol=="auto"){layout.config.app_protocol=window.location.protocol}MWF.xDesktop.getServiceAddress(layout.config,function(o,t){layout.serviceAddressList=o;layout.centerServer=t;layout.load()}.bind(this))})})()})})});