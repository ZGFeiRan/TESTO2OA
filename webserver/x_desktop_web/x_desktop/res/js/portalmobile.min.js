layout=window.layout||{};var locate=window.location;layout.protocol=locate.protocol;var href=locate.href;if(href.indexOf("debugger")!=-1)layout.debugger=true;layout.mobile=true;layout.desktop=layout;layout.session=layout.session||{};var uri=new URI(href);var appNames="portal.Portal";var id=uri.getData("id");var page=uri.getData("page");var statusObj={portalId:id,pageId:page};var options=null;COMMON.DOM.addReady(function(){COMMON.AjaxModule.load("/x_desktop/res/framework/mootools/plugin/mBox.Notice.js",null,false);COMMON.AjaxModule.load("/x_desktop/res/framework/mootools/plugin/mBox.Tooltip.js",null,false);COMMON.setContentPath("/x_desktop");COMMON.AjaxModule.load("mwf",function(){MWF.defaultPath="/x_desktop"+MWF.defaultPath;MWF.loadLP("zh-cn");MWF.require("MWF.xDesktop.Layout",function(){MWF.require("MWF.xDesktop.Authentication",null,false);MWF.xDesktop.requireApp("Common","",null,false);(function(){layout.requireApp=function(o,e,t){var n=o.split(".");var i=n[n.length-1];var a="MWF.xApplication."+o;var s=t||"Main";var l=a+"."+s;var p=a+".lp."+MWF.language;var d=MWF.xApplication;n.each(function(o,e){if(e<n.length-1){d[o]=d[o]||{}}else{d[o]=d[o]||{options:Object.clone(MWF.xApplication.Common.options)}}d=d[o]}.bind(this));if(!d.options)d.options=Object.clone(MWF.xApplication.Common.options);MWF.xDesktop.requireApp(o,"lp."+MWF.language,{onRequestFailure:function(){MWF.xDesktop.requireApp(o,"lp.zh-cn",null,false)}.bind(this),onSuccess:function(){}.bind(this)},false);MWF.xDesktop.requireApp(o,t,function(){if(e)e(d)})};layout.openApplication=function(e,o,t,n){if(layout.app){layout.desktop.openBrowserApp=o;layout.desktop.openBrowserStatus=n;layout.desktop.openBrowserOption=t;var i=JSON.encode(t);var a=JSON.encode(n);var s=t.docTitle||"";switch(o){case"process.Work":if(window.o2&&window.o2.openO2Work){if(t.workId){window.o2.openO2Work(t.workId,"",s)}else if(t.workCompletedId){window.o2.openO2Work("",t.workCompletedId,s)}}else if(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2Work){if(t.workId){window.webkit.messageHandlers.openO2Work.postMessage({work:t.workId,workCompleted:"",title:s})}else if(t.workCompletedId){window.webkit.messageHandlers.openO2Work.postMessage({work:"",workCompleted:t.workCompletedId,title:s})}}else{var l=new URI(window.location.href);var p=l.getData("redirectlink");if(!p){p=encodeURIComponent(locate.pathname+locate.search)}else{p=encodeURIComponent(p)}if(t.workId){window.location="workmobilewithaction.html?workid="+t.workId+"&redirectlink="+p}else if(t.workCompletedId){window.location="workmobilewithaction.html?workcompletedid="+t.workCompletedId+"&redirectlink="+p}}break;case"cms.Document":if(window.o2&&window.o2.openO2CmsDocument){window.o2.openO2CmsDocument(t.documentId,s)}else if(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2CmsDocument){window.webkit.messageHandlers.openO2CmsDocument.postMessage({docId:t.documentId,docTitle:s})}else{window.location="appMobile.html?app="+o+"&option="+(i||"")+"&status="+(a||"")}break;case"cms.Module":if(window.o2&&window.o2.openO2CmsApplication){window.o2.openO2CmsApplication(t.columnId,s)}else if(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2CmsApplication){window.webkit.messageHandlers.openO2CmsApplication.postMessage(t.columnId)}else{window.location="appMobile.html?app="+o+"&option="+(i||"")+"&status="+(a||"")}break;case"Meeting":if(window.o2&&window.o2.openO2Meeting){window.o2.openO2Meeting("")}else if(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2Meeting){window.webkit.messageHandlers.openO2Meeting.postMessage("")}else{window.location="appMobile.html?app="+o+"&option="+(i||"")+"&status="+(a||"")}break;case"Calendar":if(window.o2&&window.o2.openO2Calendar){window.o2.openO2Calendar("")}else if(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2Calendar){window.webkit.messageHandlers.openO2Calendar.postMessage("")}else{window.location="appMobile.html?app="+o+"&option="+(i||"")+"&status="+(a||"")}break;case"process.TaskCenter":var d=(t&&t.navi?t.navi:"task").toLowerCase();if(d==="done")d="taskCompleted";if(d==="readed")d="readCompleted";if(window.o2&&window.o2.openO2WorkSpace){window.o2.openO2WorkSpace(d)}else if(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2WorkSpace){window.webkit.messageHandlers.openO2WorkSpace.postMessage(d)}else{window.location="appMobile.html?app="+o+"&option="+(i||"")+"&status="+(a||"")}break;default:window.location="appMobile.html?app="+o+"&option="+(i||"")+"&status="+(a||"")}}else{var r=o.split(".");var w=r[r.length-1];layout.requireApp(o,function(o){this.createNewApplication(e,o,w,t,n)}.bind(this))}};layout.createNewApplication=function(o,e,t,n,i){var a=new e["Main"](this,n);a.desktop=layout;a.inBrowser=true;a.status=i;a.load(true);var s=t;if(n.appId){s=n.appId}else{if(e.options.multitask)s=s+"-"+new MWF.widget.UUID}a.appId=s;layout.app=a};layout.load=function(){this.isAuthentication(function(){layout.apps=[];this.node=$("layout");var o=window.opener;if(o){var e=o.layout.desktop.openBrowserApp||appNames;var t=o.layout.desktop.openBrowserStatus||statusObj;var n=o.layout.desktop.openBrowserOption||options;layout.openApplication(null,e,n||{},t)}else{var e=appNames;var t=statusObj;var n=options;layout.openApplication(null,e,n||{},t)}if(layout.mask)layout.mask.hide();if(document.all.appContentMask)document.all.appContentMask.destroy()}.bind(this))};layout.isAuthentication=function(e){this.authentication=new MWF.xDesktop.Authentication({onLogin:layout.load.bind(layout)});var o=true;this.authentication.isAuthenticated(function(o){this.user=o.data;this.session={};this.session.user=o.data;if(e)e()}.bind(this),function(){this.authentication.loadLogin(document.body);if(layout.mask)layout.mask.hide();if(document.all.appContentMask)document.all.appContentMask.destroy();o=false}.bind(this));return o};MWF.getJSON("res/config/config.json",function(o){layout.config=o;if(layout.config.app_protocol=="auto"){layout.config.app_protocol=window.location.protocol}MWF.xDesktop.getServiceAddress(layout.config,function(o,e){layout.serviceAddressList=o;layout.centerServer=e;layout.load()}.bind(this))})})()})})});