MWF.widget=MWF.widget||{};MWF.widget.Toolbar=new Class({Implements:[Options,Events],Extends:MWF.widget.Common,options:{style:"default"},initialize:function(t,e,i){this.setOptions(e);this.bindObject=i;this.items=[];this.children=[];this.childrenButton=[];this.childrenMenu=[];this.path=MWF.defaultPath+"/widget/$Toolbar/";this.cssPath=MWF.defaultPath+"/widget/$Toolbar/"+this.options.style+"/css.wcss";this._loadCss();this.node=$(t);this.node.onselectstart=function(){return false};this.node.oncontextmenu=function(){return false}},load:function(){if(this.fireEvent("queryLoad")){this.node.set("styles",this.css.container);this._loadToolbarItemNode();this._loadToolbarItems();this.fireEvent("postLoad")}},_loadToolbarItemNode:function(){var t=this.node.getChildren();t.each(function(t,e){var i=t.get("MWFnodetype");if(i){if(typeOf(this[i])=="array"){this[i].push(t)}else{this[i]=[];this[i].push(t)}}}.bind(this))},_loadToolbarItems:function(){this._loadToolBarSeparator(this.MWFToolBarSeparator);this._loadToolBarButton(this.MWFToolBarButton);this._loadToolBarMenu(this.MWFToolBarMenu)},_loadToolBarSeparator:function(t){if(t){t.each(function(t,e){t.set("styles",this.css.toolbarSeparator)}.bind(this))}},_loadToolBarButton:function(t){if(t){t.each(function(t,e){var i=new MWF.widget.ToolbarButton(t,this,this.options);i.load();this.fireEvent("buttonLoad",[i]);if(i.buttonID){this.items[i.buttonID]=i}this.children.push(i);this.childrenButton.push(i)}.bind(this))}},_loadToolBarMenu:function(t){var s=this;if(t){t.each(function(t,e){var i=new MWF.widget.ToolbarMenu(t,this,{onAddMenuItem:function(t){this.fireEvent("addMenuItem",[t])}.bind(this),onMenuQueryShow:function(t){s.fireEvent("menuQueryShow",[this,t])},onMenuPostShow:function(t){s.fireEvent("menuPostShow",[this,t])},onMenuQueryHide:function(t){s.fireEvent("menuQueryHide",[this,t])},onMenuPostHide:function(t){s.fireEvent("menuPostHide",[this,t])},onLoad:function(t){s.fireEvent("menuLoaded",[this,t])}});i.load();this.fireEvent("menuLoad",[i]);if(i.buttonID){this.items[i.buttonID]=i}this.children.push(i);this.childrenMenu.push(i)}.bind(this))}}});MWF.widget.ToolbarButton=new Class({Implements:[Options,Events],options:{text:"",title:"",pic:"",action:"",actionScript:"",disable:false},initialize:function(t,e,i){this.setOptions(i);this.node=$(t);this.toolbar=e;this.buttonID=this.node.get("MWFnodeid")||this.node.get("id");if(!this.node){this.node=new Element("div").inject(this.toolbar.node)}else{var s=this.node.get("MWFButtonText");if(s)this.options.text=s;var o=this.node.get("title");if(o)this.options.title=o;var n=this.node.get("MWFButtonImage");if(n)this.options.pic=n;var h=this.node.get("MWFButtonDisable");if(h)this.options.disable=true;var d=this.node.get("MWFButtonAction");if(d)this.options.action=d}this.modifiyStyle=true},load:function(){this._addButtonEvent();this.node.title=this.options.title;this.node.set("styles",this.toolbar.css.button);if(this.options.pic)this.picNode=this._createImageNode(this.options.pic);if(this.options.text)this.textNode=this._createTextNode(this.options.text);this.setDisable(this.options.disable)},enable:function(){if(this.options.disable){this.setDisable(false);this.options.disable=false}},disable:function(){if(!this.options.disable){this.setDisable(true);this.options.disable=true}},setDisable:function(t){if(t){this.node.set("styles",this.toolbar.css.buttonDisable);if(this.picNode){this.picNode.set("styles",this.toolbar.css.buttonImgDivDisable);var e=this.picNode.getElement("img");var i=e.get("src");var s=i.substr(i.lastIndexOf("."),i.length);i=i.substr(0,i.lastIndexOf("."));i=i+"_gray"+s;e.set("src",i)}if(this.textNode)this.textNode.set("styles",this.toolbar.css.buttonTextDivDisable)}else{this.node.set("styles",this.toolbar.css.button);if(this.picNode){this.picNode.set("styles",this.toolbar.css.buttonImgDiv);var e=this.picNode.getElement("img");var i=e.get("src");i=i.replace("_gray","");e.set("src",i)}if(this.textNode)this.textNode.set("styles",this.toolbar.css.buttonTextDiv)}},_createImageNode:function(t){if(t){var e=new Element("span",{styles:this.toolbar.css.buttonImgDiv}).inject(this.node);var i=new Element("img",{styles:this.toolbar.css.buttonImg,src:t}).inject(e);return e}else{return null}},_createTextNode:function(t){if(t){var e=new Element("span",{styles:this.toolbar.css.buttonTextDiv,text:t}).inject(this.node);return e}else{return null}},setText:function(t){this.node.getLast().set("text",t)},_addButtonEvent:function(){this.node.addEvent("mouseover",this._buttonMouseOver.bind(this));this.node.addEvent("mouseout",this._buttonMouseOut.bind(this));this.node.addEvent("mousedown",this._buttonMouseDown.bind(this));this.node.addEvent("mouseup",this._buttonMouseUp.bind(this));this.node.addEvent("click",this._buttonClick.bind(this))},_buttonMouseOver:function(){if(this.modifiyStyle)if(!this.options.disable){this.node.set("styles",this.toolbar.css.buttonOver)}},_buttonMouseOut:function(){if(this.modifiyStyle)if(!this.options.disable){this.node.set("styles",this.toolbar.css.buttonOut)}},_buttonMouseDown:function(){if(this.modifiyStyle)if(!this.options.disable){this.node.set("styles",this.toolbar.css.buttonDown)}},_buttonMouseUp:function(){if(this.modifiyStyle)if(!this.options.disable){this.node.set("styles",this.toolbar.css.buttonUp)}},_buttonClick:function(t){if(!this.options.disable){if(this.options.action){if(typeOf(this.options.action)==="string"){var e=this.options.action.split(":");var i=e.shift();var s=this.toolbar.bindObject?this.toolbar.bindObject:window;if(s[i]){e.push(this);e.push(t);s[i].apply(s,e)}else{if(window[i]){window[i].apply(this,e)}}}else{this.options.action()}}}}});MWF.widget.ToolbarMenu=new Class({Implements:[Options,Events],Extends:MWF.widget.ToolbarButton,initialize:function(t,e,i){this.parent(t,e,i);this.modifiyStyle=true;this.menu=null;this.buttonID=this.node.get("MWFnodeid")||this.node.get("id")},setDisable:function(t){if(this.menu)this.menu.options.disable=t;if(t){this.node.set("styles",this.toolbar.css.buttonDisable);if(this.picNode){this.picNode.set("styles",this.toolbar.css.buttonImgDivDisable);var e=this.picNode.getElement("img");var i=e.get("src");var s=i.substr(i.lastIndexOf("."),i.length);i=i.substr(0,i.lastIndexOf("."));i=i+"_gray"+s;e.set("src",i)}if(this.textNode)this.textNode.set("styles",this.toolbar.css.buttonTextDivDisable)}else{this.node.set("styles",this.toolbar.css.button);if(this.picNode){this.picNode.set("styles",this.toolbar.css.buttonImgDiv);var e=this.picNode.getElement("img");var i=e.get("src");i=i.replace("_gray","");e.set("src",i)}if(this.textNode)this.textNode.set("styles",this.toolbar.css.buttonTextDiv)}},load:function(){this._addButtonEvent();this.node.title=this.options.title;this.node.set("styles",this.toolbar.css.button);if(this.options.pic)this.picNode=this._createImageNode(this.options.pic);if(this.options.text)this.textNode=this._createTextNode(this.options.text);this._createDownNode();var i=this;MWF.require("MWF.widget.Menu",function(){this.menu=new MWF.widget.Menu(this.node,{style:this.toolbar.options.style,bindObject:this.options.bindObject,event:"click",disable:i.options.disable,onQueryShow:function(){var t=i.node.getPosition();var e=i.node.getSize();this.setOptions({top:t.y+e.y-2,left:t.x});i.fireEvent("menuQueryShow",[this]);return true},onPostShow:function(){var t=i.node.getPosition();var e=i.node.getSize();i.node.set("styles",{"background-color":this.node.getStyle("background-color"),"border-top":this.node.getStyle("border-top"),"border-right":this.node.getStyle("border-top"),"border-left":this.node.getStyle("border-top"),"border-bottom":"0"});i.modifiyStyle=false;i.tmpStyleNode=new Element("div",{styles:{position:"absolute",top:t.y+e.y-2,left:t.x+1,width:e.x-2,"z-index":this.node.getStyle("z-index")+1,"background-color":this.node.getStyle("background-color"),height:"1px",overflow:"hidden"}}).inject($(document.body));i.fireEvent("menuPostShow",[this])},onQueryHide:function(){i.fireEvent("menuQueryHide",[this])},onPostHide:function(){i.node.set("styles",i.toolbar.css.button);i.modifiyStyle=true;if(i.tmpStyleNode)i.tmpStyleNode.destroy();i.fireEvent("menuPostHide",[this])}});this.menu.load();this.fireEvent("load",[this.menu]);this.addMenuItems()}.bind(this));this.setDisable(this.options.disable)},_createDownNode:function(){var t=new Element("div",{styles:this.toolbar.css.toolbarButtonDownNode}).inject(this.node);t.set("html",'<img src="'+MWF.defaultPath+"/widget/$Toolbar/"+this.toolbar.options.style+"/downicon.gif"+'" />');return t},addMenuItems:function(){var t=this.node.getChildren();t.each(function(t,e){var i=t.get("MWFnodetype");if(i=="MWFToolBarMenuItem"){this._loadMenuItem(t)}if(i=="MWFToolBarMenuLine"){this._loadMenuLine(t)}}.bind(this))},_loadMenuItem:function(e){var i=this;var t=this.menu.addMenuItem(e.get("MWFButtonText"),"click",function(t){i._menuItemClick(e.get("MWFButtonAction"),t,this)},e.get("MWFButtonImage"),e.get("MWFButtonDisable"));this.fireEvent("addMenuItem",[t])},_menuItemClick:function(t,e,i){if(t){var s=t.split(":");var o=s.shift();var n=this.toolbar.bindObject?this.toolbar.bindObject:window;if(n[o]){s.push(this);s.push(e);s.push(i);n[o].apply(n,s);this.menu.hideMenu()}else{if(window[o]){window[o].apply(this,s);this.menu.hideMenu()}}}},_loadMenuLine:function(){this.menu.addMenuLine()}});