MWF.xAction.RestActions.Action["x_portal_assemble_designer"]=new Class({Extends:MWF.xAction.RestActions.Action,getUUID:function(a){var i="";this.action.invoke({name:"getId",async:false,parameter:{count:"1"},success:function(e){i=e.data[0].id;if(a)a(i)},failure:null});return i},listApplicationSummary:function(e,a,i,n){if(e){this.action.invoke({name:"listApplicationByCategorySummary",async:n,parameter:{applicationCategory:e},success:a,failure:i})}else{this.action.invoke({name:"listApplicationSummary",async:n,success:a,failure:i})}},saveApplication:function(e,a,i){if(e.id){this.updateApplication(e.id,e,a,i)}else{this.addApplication(e,a,i)}},savePage:function(e,a,i,n,t){if(!e.isNewPage){this.updatePage(e,a,i,n,t)}else{this.addPage(e,a,i,n,t)}},updatePage:function(e,a,i,n,t){var s,o;if(e)s=MWF.encodeJsonString(JSON.encode(e));if(a)o=MWF.encodeJsonString(JSON.encode(a));var d={id:e.json.id,name:e.json.name,alias:e.json.name,description:e.json.description,portal:e.json.application,icon:e.json.formIcon,formFieldList:i};if(a&&a.json.moduleList){if(Object.keys(a.json.moduleList).length){d.hasMobile=true}else{d.hasMobile=false}}if(e)d.data=s;if(a)d.mobileData=o;debugger;this.action.invoke({name:"updatePage",data:d,parameter:{id:e.json.id},success:n,failure:t})},saveFile:function(a,i,n){if(a.id){this.updataFile(a.id,a,i,n)}else{this.getUUID(function(e){a.id=e;this.addFile(a,i,n)}.bind(this))}},addPage:function(i,n,t,s,o){var d,c;if(!i.json.id){this.getUUID(function(e){i.json.id=e;if(i)d=MWF.encodeJsonString(JSON.encode(i));if(n)c=MWF.encodeJsonString(JSON.encode(n));var a={id:i.json.id,name:i.json.name,hasMobile:false,alias:i.json.name,description:i.json.description,portal:i.json.application,icon:i.json.formIcon,formFieldList:t};if(n&&n.json.moduleList){if(Object.keys(n.json.moduleList).length){a.hasMobile=true}else{a.hasMobile=false}}if(i)a.data=d;if(n)a.mobileData=c;this.action.invoke({name:"addPage",data:a,parameter:{id:i.json.categoryId},success:s,failure:o})}.bind(this))}else{if(i)d=MWF.encodeJsonString(JSON.encode(i));if(n)c=MWF.encodeJsonString(JSON.encode(n));var e={id:i.json.id,name:i.json.name,alias:i.json.name,hasMobile:false,description:i.json.description,portal:i.json.application};if(n&&n.json.moduleList){if(Object.keys(n.json.moduleList).length){e.hasMobile=true}else{e.hasMobile=false}}if(i)e.data=d;if(n)e.mobileData=c;this.action.invoke({name:"addPage",data:e,parameter:{id:i.json.categoryId},success:s,failure:o})}},addPageTemplate:function(n,t,s,o,d){var c,u;this.getUUID(function(e){s.id=e;if(n){var a=Object.clone(n);a.json.id=e;a.json.name=s.name;c=MWF.encodeJsonString(JSON.encode(a))}if(t){var i=Object.clone(t);i.json.id=e;i.json.name=s.name;u=MWF.encodeJsonString(JSON.encode(i))}if(n)s.data=c;if(t)s.mobileData=u;this.action.invoke({name:"addPageTemplate",data:s,success:o,failure:d})}.bind(this))},saveSource:function(e,a,i){if(!e.isNewSource){this.updateSource(e,a,i)}else{this.addSource(e,a,i)}},updateSource:function(e,a,i){var n=e.data;e.data=JSON.encode(e.data);this.action.invoke({name:"updataSource",data:e,parameter:{id:e.id},success:a,failure:i});e.data=n},addSource:function(a,i,n){var t=a.data;a.data=JSON.encode(a.data);if(!t.id){this.getUUID(function(e){a.id=e;this.action.invoke({name:"addSource",data:a,success:i,failure:n});a.data=t}.bind(this))}else{this.action.invoke({name:"addSource",data:a,success:i,failure:n});a.data=t}},saveMenu:function(e,a,i){if(!e.isNewMenu){this.updateMenu(e,a,i)}else{this.addStat(e,a,i)}},updateMenu:function(e,a,i){var n=e.data;e.data=JSON.encode(e.data);this.action.invoke({name:"updataMenu",data:e,parameter:{id:statData.id},success:a,failure:i});e.data=n},addMenu:function(a,i,n){var t=a.data;a.data=JSON.encode(a.data);if(!t.id){this.getUUID(function(e){a.id=e;this.action.invoke({name:"addMenu",data:a,success:i,failure:n});a.data=t}.bind(this))}else{this.action.invoke({name:"addMenu",data:a,success:i,failure:n});a.data=t}},saveScript:function(e,a,i){if(!e.isNewScript){this.updateScript(e,a,i)}else{this.addScript(e,a,i)}},updateScript:function(e,a,i){this.action.invoke({name:"updataScript",data:e,parameter:{id:e.id},success:a,failure:i})},addScript:function(a,i,n){a.portal=a.application;if(!a.id){this.getUUID(function(e){a.id=e;this.action.invoke({name:"addScript",data:a,success:i,failure:n})}.bind(this))}else{this.action.invoke({name:"addScript",data:a,success:i,failure:n})}},changeApplicationIcon:function(e,a,i,n,t){this.action.invoke({name:"updateApplicationIcon",parameter:{id:e},data:n,file:t,success:a,failure:i})}});