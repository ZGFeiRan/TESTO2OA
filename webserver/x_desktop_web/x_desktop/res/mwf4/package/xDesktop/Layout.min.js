MWF.xDesktop=MWF.xDesktop||{};MWF.xDesktop.requireApp=function(t,e,i,s){var n=t.split(".");var o="x_component_"+n.join("_");var a=e||"Main";path="/"+o+"/"+a.replace(/\./g,"/")+".js";COMMON.AjaxModule.load(path,i,s)};MWF.xApplication=MWF.xApplication||{};MWF.require("MWF.widget.Common",null,false);MWF.require("MWF.xDesktop.Common",null,false);MWF.require("MWF.xAction.RestActions",null,false);MWF.require("MWF.xDesktop.Menu",null,false);MWF.require("MWF.widget.UUID",null,false);MWF.require("MWF.xDesktop.Lnk",null,false);MWF.require("MWF.xDesktop.Actions.RestActions",null,false);MWF.require("MWF.xDesktop.Authentication",null,false);MWF.require("MWF.xDesktop.Message",null,false);MWF.require("MWF.xDesktop.UserData",null,false);MWF.require("MWF.xDesktop.shortcut",null,false);MWF.require("MWF.widget.PinYin",null,false);MWF.xDesktop.requireApp("Common","",null,false);MWF.xDesktop.requireApp("Common","Widget",null,false);MWF.require("MWF.xDesktop.WebSocket",null,false);MWF.require("MWF.xDesktop.Access",null,false);MWF.xDesktop.Layout=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",topShim:"layout_top_shim",top:"layout_top",desktop:"layout_desktop",content:"desktop_content",navi:"desktop_navi"},categoryCount:20,processCount:40,initialize:function(e,t){this.setOptions(t);this.type="layout";this.path=MWF.defaultPath+"/xDesktop/$Layout/";this.initData(function(){this.authentication=new MWF.xDesktop.Authentication({onLogin:this.load.bind(this)});this.authentication.isAuthenticated(function(t){this.session.user=t.data;layout.session.user=t.data;this.getStyleLoad(e)}.bind(this),function(){this.getPublicStyleLoad(e)}.bind(this))}.bind(this))},getPublicStyleLoad:function(e){MWF.UD.getPublicData("defaultLayout",function(t){if(t){this.status=t}this.initNode(e);this.load()}.bind(this))},getStyleLoad:function(i){debugger;MWF.UD.getPublicData("forceLayout",function(t){var e=null;if(t){e=t}MWF.UD.getData("layout",function(t){if(t.data){this.status=JSON.decode(t.data);if(e)this.status.apps=Object.merge(this.status.apps,e.apps);if(this.status.style)this.options.style=this.status.style;if(this.status.styleType)this.options.styleType=this.status.styleType;this.initNode(i);this.load()}else{MWF.UD.getPublicData("defaultLayout",function(t){if(t){this.status=t;if(e)this.status.apps=Object.merge(this.status.apps,e.apps);if(this.status.style)this.options.style=this.status.style;if(this.status.styleType)this.options.styleType=this.status.styleType}this.initNode(i);this.load()}.bind(this))}}.bind(this))}.bind(this))},loadCss:function(){debugger;var t=new URI(window.location.href);var e=t.getData("style");var i=t.getData("styletype");if(e){if(i=="custom"){MWF.UD.getPublicData(e,function(t){if(t&&t.data.desktop&&t.data.window){this.css=t.data.desktop;this.windowCss=t.data.window}else{MWF.UD.deletePublicData(e);this.options.style="default";this.cssPath=MWF.defaultPath+"/xDesktop/$Layout/"+this.options.style+"/css.wcss";this._loadCss()}}.bind(this),false)}else{this.options.style=e;this.cssPath=MWF.defaultPath+"/xDesktop/$Layout/"+this.options.style+"/css.wcss";this._loadCss()}}else{if(!this.status||!this.status.style||this.status.styleType!="custom"){if(this.status)if(this.status.style)this.options.style=this.status.style;this.cssPath=MWF.defaultPath+"/xDesktop/$Layout/"+this.options.style+"/css.wcss";this._loadCss();if(!this.css){this.options.style="default";this.cssPath=MWF.defaultPath+"/xDesktop/$Layout/"+this.options.style+"/css.wcss";this._loadCss()}}else{MWF.UD.getPublicData(this.status.style,function(t){if(t&&t.data.desktop&&t.data.window){this.css=t.data.desktop;this.windowCss=t.data.window}else{MWF.UD.deletePublicData(this.status.style);this.options.style="default";this.cssPath=MWF.defaultPath+"/xDesktop/$Layout/"+this.options.style+"/css.wcss";this._loadCss()}}.bind(this),false)}}},initNode:function(t){debugger;this.loadCss();this.node=$(t);this.topShimNode=this.node.getElement("#"+this.options.topShim);this.topNode=this.node.getElement("#"+this.options.top);this.topAreaNode=this.node.getElement("#"+this.options.top);this.desktopNode=this.node.getElement("#"+this.options.desktop);this.contentNode=this.node.getElement("#"+this.options.content);this.naviNode=this.node.getElement("#"+this.options.navi);if(this.node)this.node.setStyles(this.css.layoutNode);if(this.topShimNode)this.topShimNode.setStyles(this.css.layoutTopShimNode);if(this.topNode)this.topNode.setStyles(this.css.layoutTopNode);if(this.desktopNode)this.desktopNode.setStyles(this.css.desktopNode);if(this.contentNode)this.contentNode.setStyles(this.css.contentNode);if(this.naviNode)this.naviNode.setStyles(this.css.naviNode);var e=this.css.desktop.background;this.node.setStyle("background-image",this.css.desktop.background)},initData:function(i){this.apps={};this.widgets={};this.appCurrentList=[];this.lnkAreas=[];this.lnks=[];this.currentApp=null;this.status=null;this.session={};this.serviceAddressList=null;debugger;MWF.xDesktop.getServiceAddress(layout.config,function(t,e){this.serviceAddressList=t;this.centerServer=e;if(i)i()}.bind(this))},isAuthentication:function(t){var e=true;if(this.session.user){if(t)t()}else{this.authentication.loadLogin(this.node);this.fireEvent("login");e=false}return e},load:function(){if(document.body.addEventListener){document.body.addEventListener("dragover",function(t){t.stopPropagation();t.preventDefault()}.bind(this),false)}this.isAuthentication(function(){if(this.status){if(this.status.style){if(this.options.style!==this.status.style){this.changStyle(this.status.style)}}}this.getNodeBackground();this.loadDesktop();if(this.session.user.passwordExpired){this.openApplication({page:{x:0,y:0}},"Profile",{tab:"passwordConfigPage"});window.setTimeout(function(){MWF.xDesktop.notice("error",{y:"top",x:"left"},MWF.LP.desktop.notice.changePassword,this.desktopNode)}.bind(this),500)}if(MWF.AC.isAdministrator()){}this.fireEvent("load")}.bind(this))},checkO2Collect:function(){var e=new MWF.xDesktop.Actions.RestActions("/xDesktop/Actions/action.json","x_program_center");e.invoke({name:"collectConnected",success:function(t){if(t.data.value){e.invoke({name:"collectValidate",success:function(t){if(!t.data.value){this.openApplication({page:{x:0,y:0}},"Collect")}}.bind(this),failure:function(){this.openApplication({page:{x:0,y:0}},"Collect")}.bind(this)})}else{this.showMessageNotConnectCollect()}}.bind(this),failure:function(){this.showMessageNotConnectCollect()}.bind(this)})},showMessageNotConnectCollect:function(){var t={subject:MWF.LP.desktop.collect.collectNotConnected,content:MWF.LP.desktop.collect.collectNotConnectedText};var e=layout.desktop.message.addTooltip(t);var i=layout.desktop.message.addMessage(t)},loadDesktop:function(){this.setHeight();var t=this.desktopNode.getSize();this.size={x:t.x,y:t.y};this.loadTop();this.loadLnkArea();this.setEvent();this.loadWidget();this.loadStatus(function(){this.openWebSocket()}.bind(this))},openWebSocket:function(){this.socket=new MWF.xDesktop.WebSocket;window.setTimeout(this.checkWebSocket.bind(this),3e4)},checkWebSocket:function(){if(!this.socket||this.socket.webSocket.readyState!==1){this.socket=new MWF.xDesktop.WebSocket}window.setTimeout(this.checkWebSocket.bind(this),3e4)},loadWidget:function(){},loadLnkAreaContainer:function(){this.lnkAreaContainer=new Element("div",{styles:{height:"100%",overflow:"hidden"}}).inject(this.contentNode)},loadLnkArea:function(){if(!this.lnkAreaContainer)this.loadLnkAreaContainer();var t=new Element("div",{styles:this.css.dsektopLnkArea}).inject(this.lnkAreaContainer);this.lnkAreas.push(t);var e=t.getSize().x*this.lnkAreas.length;var i=this.contentNode.getSize();this.lnkAreaContainer.setStyle("width",""+Math.max(e,i.x)+"px");this.setCurrentLnkArea()},setCurrentLnkArea:function(){if(this.lnkAreas.length>1){var t=this.lnkAreas[0].getSize().x;var e=t*this.lnkAreas.length;var i=this.contentNode.getSize();var s=this.lnkAreas[this.lnkAreas.length-1];if(e<i.x){e=e-t;s.setStyles({width:"auto","margin-left":""+e+"px",float:"none"})}else{s.setStyles(this.css.dsektopLnkArea)}}else{if(this.lnkAreas.length){this.lnkAreas[0].setStyles({width:"auto","margin-left":"0px",float:"none"})}}},addLnkArea:function(){if(this.lnkAreas.length){this.lnkAreas[this.lnkAreas.length-1].setStyles(this.css.dsektopLnkArea)}this.loadLnkArea()},addLnk:function(t){var e=new MWF.xDesktop.Lnk(t.icon,t.title,t.par);if(!this.lnkAreas.length)this.loadLnkArea();e.inject(this.lnkAreas[this.lnkAreas.length-1]);this.lnks.push(e)},resizeLnk:function(){if(this.lnkAreaContainer){if(this.lnkAreas.length>1){var t=this.lnkAreas[0].getSize().x*this.lnkAreas.length;var e=this.contentNode.getSize();this.lnkAreaContainer.setStyle("width",""+Math.max(t,e.x)+"px")}else{this.lnkAreaContainer.setStyle("width",""+this.contentNode.getSize().x+"px")}}var n=0;var o=0;this.lnks.each(function(t,e){while(!this.lnkAreas[n])this.addLnkArea();var i=this.lnkAreas[n];t.inject(i);o++;var s=t.node.getSize().y+t.node.getStyle("margin-top").toFloat();if(s*(o+1)>i.getSize().y){if(e<this.lnks.length-1)n++;o=0}}.bind(this));if(this.lnkAreas.length)while(this.lnkAreas.length>n+1)this.lnkAreas.pop().destroy();this.setCurrentLnkArea()},refreshApp:function(t){if(t.window){var e={id:t.appId,name:t.options.name,style:t.options.style,appId:t.appId,window:{size:{x:t.window.css.to.width.toFloat(),y:t.window.css.to.height.toFloat()},position:{x:t.window.css.to.left.toFloat(),y:t.window.css.to.top.toFloat()},isMax:t.window.isMax,isHide:t.window.isHide,style:t.window.options.style},app:null};if(t.recordStatus)e.app=t.recordStatus();t.close();this.openApplicationWithStatus(e)}},openApplicationWithStatus:function(i){var t=i.name;var s=i.style?i.style:"default";this.requireApp(t,function(t){var e=new t["Main"](this,{style:s,isRefresh:true,onLoadWindow:function(){this.window.setOptions({top:i.window.position.y,left:i.window.position.x,width:i.window.size.x,height:i.window.size.y});this.window.reStyle()},onPostLoadWindow:function(){if(i.window.isMax){this.maxSize(function(){this.fireAppEvent("postLoadWindowMax")}.bind(this))}if(i.window.isHide){this.minSize(function(){this.fireAppEvent("postLoadWindowMin")}.bind(this))}},onPostLoad:function(){}});e.desktop=this;e.appId=i.id;e.taskitem=new MWF.xDesktop.Layout.Taskitem(e,this);this.apps[i.id]=e;e.status=i.app;this.appCurrentList.push(e);e.loadNoAnimation(true,i.window.isMax,i.window.isHide)}.bind(this))},loadStatus:function(t){if(this.status){if(this.status.apps){Object.each(this.status.apps,function(i,s){var t=i.name;var n=i.style?i.style:"default";this.requireApp(t,function(t){var e=new t["Main"](this,{style:n,isRefresh:true,onLoadWindow:function(){this.window.setOptions({top:i.window.position.y,left:i.window.position.x,width:i.window.size.x,height:i.window.size.y});this.window.reStyle()},onPostLoadWindow:function(){if(i.window.isMax){this.maxSize(function(){this.fireAppEvent("postLoadWindowMax")}.bind(this))}if(i.window.isHide){this.minSize(function(){this.fireAppEvent("postLoadWindowMin")}.bind(this))}},onPostLoad:function(){}});e.desktop=this;e.appId=s;e.taskitem=new MWF.xDesktop.Layout.Taskitem(e,this);this.apps[s]=e;e.status=i.app;this.appCurrentList.push(e);e.loadNoAnimation(this.status.currentApp==s,i.window.isMax,i.window.isHide)}.bind(this))}.bind(this))}debugger;if(this.status.widgets){Object.each(this.status.widgets,function(i,s){var n=i.name;var t=i.appName;this.requireApp(t,function(t){var e=new t[n](this,{position:i.position,onLoadWidget:function(){this.widget.setOptions({position:i.position})}});e.desktop=this;e.widgetId=s;this.widgets[s]=e;e.status=i.widget;e.load()}.bind(this),n)}.bind(this))}if(this.status.lnks){this.status.lnks.each(function(t){this.addLnk(t)}.bind(this));this.resizeLnk()}}var e=false;var i=false;var s=function(){if(e&&i)if(t)t()};var n=MWF.defaultPath+"/xDesktop/$Layout/applications.json";MWF.getJSON(n,function(t){t.each(function(t,e){if(t.widgetName){if(t.widgetStart){this.openWidget(null,t.widgetName,t.path)}}}.bind(this));e=true;s()}.bind(this));var o=new MWF.xDesktop.Actions.RestActions("/xDesktop/Actions/action.json","x_component_assemble_control");o.invoke({name:"listComponent",success:function(t){var e=this.session.user;var n=[e.name,e.distinguishedName,e.id,e.unique];if(e.roleList)n=n.concat(e.roleList);if(e.groupList)n=n.concat(e.groupList);t.data.each(function(t,e){if(t.visible){var i=t.allowList.length?t.allowList.isIntersect(n):true;var s=t.denyList.length?t.denyList.isIntersect(n):false;if(!s&&i||MWF.AC.isAdministrator()){if(t.widgetName){if(t.widgetStart){this.openWidget(null,t.widgetName,t.path)}}}}}.bind(this));i=true;s()}.bind(this)})},setEvent:function(){this.node.addEvent("selectstart",function(t){var e="text";if(t.target.getStyle("-webkit-user-select")){e=t.target.getStyle("-webkit-user-select").toString().toLowerCase()}if(e.toString()!=="text"&&e.toString()!=="auto")t.preventDefault()});window.onunload=function(t){if(this.socket){this.socket.close()}}.bind(this);window.onbeforeunload=function(t){if(!this.isLogout){if(!this.notRecordStatus)this.recordDesktopStatus();if(this.socket&&this.socket.webSocket&&this.socket.webSocket.readyState.toInt()===1){this.socket.webSocket.close()}this.fireEvent("unload");t=t||window.event;t.returnValue=MWF.LP.desktop.notice.unload;return MWF.LP.desktop.notice.unload}}.bind(this)},recordDesktopStatus:function(t){Object.each(this.apps,function(t,e){if(!t.options.desktopReload){this.closeApp(t)}}.bind(this));this.recordStatusData(function(){if(t)t()})},getLayoutStatusData:function(){var s={style:this.options.style,styleType:this.options.styleType||"",currentApp:this.currentApp?this.currentApp.appId:"",apps:{},lnks:[],widgets:{}};Object.each(this.apps,function(t,e){if(t.window){if(t.options.desktopReload){var i={name:t.options.name,style:t.options.style,window:{size:{x:t.window.css.to.width.toFloat(),y:t.window.css.to.height.toFloat()},position:{x:t.window.css.to.left.toFloat(),y:t.window.css.to.top.toFloat()},isMax:t.window.isMax,isHide:t.window.isHide,style:t.window.options.style},app:null};if(t.recordStatus)i.app=t.recordStatus();s.apps[e]=i}}});this.lnks.each(function(t){s.lnks.push({icon:t.icon,title:t.title,par:t.par})});Object.each(this.widgets,function(t,e){var i={name:t.options.name,appName:t.options.appName,position:t.options.position,widget:null};if(t.recordStatus)i.widget=t.recordStatus();s.widgets[e]=i});return s},recordStatusData:function(t){var e=this.getLayoutStatusData();MWF.UD.putData("layout",e,function(){if(t)t()})},getPageDesignerStyle:function(i){if(!this.pageDesignerStyle){this.pageDesignerStyle="default";MWF.UD.getData("pageDesignerStyle",function(t){if(t.data){var e=JSON.decode(t.data);this.pageDesignerStyle=e.style}if(i)i()}.bind(this))}else{if(i)i()}},getFormDesignerStyle:function(i){if(!this.formDesignerStyle){this.formDesignerStyle="default";MWF.UD.getData("formDesignerStyle",function(t){if(t.data){var e=JSON.decode(t.data);this.formDesignerStyle=e.style}if(i)i()}.bind(this))}else{if(i)i()}},recordStatusCookies:function(t){var e=JSON.encode(t);Cookie.write("xdesktop",e)},setHeight:function(){this.resizeHeight();$(window).addEvent("resize",function(){this.resizeHeight()}.bind(this))},resizeHeight:function(){var t=this.topNode.getSize().y;var e=$(document.body).getSize().y;var i=e-t;this.desktopNode.setStyle("height",""+i+"px");this.desktopHeight=i;var s=this.naviNode.getSize().y;i=i-s;this.contentNode.setStyle("height",""+i+"px");this.resizeApps();this.resizeLnk();this.resizeMessage();this.setTaskitemSize();if(this.top)if(this.top.userPanel)this.top.userPanel.setPosition();this.fireEvent("resize")},setTaskitemSize:function(){if(this.top){var t=10;var e=5;var i=this.top.taskbar.getSize();var s=this.top.taskbar.getChildren();var n=0;if(s.length){var o=s[0].getStyles("border-left-width","border-right-width","margin-left","margin-right","padding-left","padding-right");for(var a=0;a<s.length;a++){s[a].setStyle("width","auto");n+=s[a].getSize().x+o["border-left-width"].toInt()+o["border-right-width"].toInt()+o["margin-left"].toInt()+o["margin-right"].toInt()+o["padding-left"].toInt()+o["padding-right"].toInt()}if(n>i.x-t){var l=(i.x-t)/s.length;var c=l-o["border-left-width"].toInt()-o["border-right-width"].toInt()-o["margin-left"].toInt()-o["margin-right"].toInt()-o["padding-left"].toInt()-o["padding-right"].toInt();s.each(function(t){t.setStyle("width",""+c+"px")})}else{s.each(function(t){t.setStyle("width","auto")})}}}},resizeMessage:function(){if(this.message)this.message.resize()},resizeApps:function(){var n=$(document.body).getSize();Object.each(this.apps,function(t,e){var i=t.window.css.to.left.toFloat();var s=t.window.css.to.top.toFloat();if(i>n.x)i=n.x-100;if(s>n.y)s=n.y-100;t.window.css.to.left=i+"px";t.window.css.to.top=s+"px";if(t.window.css.spacerTo)t.window.css.spacerTo.left=i+"px";if(t.window.css.spacerTo)t.window.css.spacerTo.top=s+"px";if(!t.window.isHide){if(t.window.isMax){t.window.maxSizeIm()}else{t.window.restoreIm()}}}.bind(this))},loadTop:function(){if(!this.top){this.top=new MWF.xDesktop.Layout.Top(this.topNode,this);this.top.load()}},loadNavi:function(){if(!this.navi){this.navi=new MWF.xDesktop.Layout.Navi(this.naviNode,this);this.navi.load()}},getNodeBackground:function(){MWF.UD.getDataJson("layoutDesktop",function(t){var e=this.css.desktop.background;if(t){currentSrc=t.src;e="url("+MWF.defaultPath+"/xDesktop/$Layout/"+currentSrc+"/desktop.jpg"+")"}this.node.setStyle("background-image",e)}.bind(this),false)},changStyle:function(t,e){debugger;if(!e){this.options.style=t;this.options.styleType="default";this.cssPath=MWF.defaultPath+"/xDesktop/$Layout/"+this.options.style+"/css.wcss";this._loadCss()}else{this.options.style=t;this.options.styleType="custom";MWF.UD.getPublicData(t,function(t){this.css=t.data.desktop;this.windowCss=t.data.window}.bind(this),false)}MWF.require("MWF.widget.Mask",function(){this.mask=new MWF.widget.Mask({style:"desktop"});this.mask.load();window.setTimeout(function(){if(this.node)this.node.setStyles(this.css.layoutNode);if(this.topShimNode)this.topShimNode.setStyles(this.css.layoutTopShimNode);if(this.topNode)this.topNode.setStyles(this.css.layoutTopNode);if(this.desktopNode)this.desktopNode.setStyles(this.css.desktopNode);if(this.contentNode)this.contentNode.setStyles(this.css.contentNode);if(this.naviNode)this.naviNode.setStyles(this.css.naviNode);if(this.message){if(this.message.unreadNode){this.message.unreadNode.clearStyles();this.message.unreadNode.setStyles(this.css.messageUnreadCountNode)}}this.getNodeBackground();this.changeAppsStyle();if(this.top)this.top.changStyle();if(this.navi)this.navi.changStyle();Object.each(this.apps,function(t){if(t.taskitem)t.taskitem.changStyle()});this.resizeHeight();this.mask.hide()}.bind(this),0)}.bind(this))},changeAppsStyle:function(){Object.each(this.apps,function(t,e){t.window.options.style="desktop_"+this.options.style;t.window.changeStyle()}.bind(this))},openProcessApp:function(t,e){var i={id:e.id,appId:"process.Application"+e.id};this.openApplication(t,"process.Application",i)},openQueryApp:function(t,e){var i={id:e.id,appId:"query.Query"+e.id};this.openApplication(t,"query.Query",i)},openPortalApp:function(t,e){var i={portalId:e.id,appId:"portal.Portal"+e.id};this.openApplication(t,"portal.Portal",i)},openCMSApp:function(t,e){var i="cms.Module"+e.id;if(this.apps[i]){this.apps[i].setCurrent()}else{this.openApplication(t,"cms.Module",{columnData:e,appId:i})}},openWidget:function(e,i,s,n,o){debugger;this.requireApp(s,function(t){if(!this.widgets[s+i]){this.createNewWidget(e,t,s+i,i,n,o)}}.bind(this),i)},openApplication:function(e,t,i,s){var n=t.split(".");var o=n[n.length-1];this.requireApp(t,function(t){if(t.options.multitask){if(i&&i.appId){if(this.apps[i.appId]){this.apps[i.appId].setCurrent()}else{this.createNewApplication(e,t,o,i,s)}}else{this.createNewApplication(e,t,o,i,s)}}else{if(this.apps[o]){this.apps[o].setCurrent()}else{this.createNewApplication(e,t,o,i,s)}}}.bind(this))},createNewWidget:function(t,e,i,s,n,o){var a=new e[s](this,n);a.desktop=this;if(o){Object.each(o,function(t,e){app[e]=t})}a.load(true);var l=i;if(n){if(n.widgetId){l=n.widgetId}}a.widgetId=l;this.widgets[l]=a},createNewApplication:function(t,e,i,s,n){if(s){s.event=t}else{s={event:t}}var o=new e["Main"](this,s);o.desktop=this;if(n){Object.each(n,function(t,e){o[e]=t})}o.taskitem=new MWF.xDesktop.Layout.Taskitem(o,this);o.load(true);var a=i;if(s.appId){a=s.appId}else{if(e.options.multitask)a=a+"-"+new MWF.widget.UUID}o.appId=a;this.apps[a]=o;return o},closeApp:function(t){var e=t.appId;this.appCurrentList.erase(t);this.setTaskitemSize();delete this.apps[e]},closeWidget:function(t){var e=t.widgetId;delete this.widgets[e]},requireApp:function(t,e,i){var s=t.split(".");var n=s[s.length-1];var o="MWF.xApplication."+t;var a=i||"Main";var l=o+"."+a;var c=o+".lp."+MWF.language;var p=MWF.xApplication;s.each(function(t,e){if(e<s.length-1){p[t]=p[t]||{}}else{p[t]=p[t]||{options:Object.clone(MWF.xApplication.Common.options)}}p=p[t]}.bind(this));if(!p.options)p.options=Object.clone(MWF.xApplication.Common.options);MWF.xDesktop.requireApp(t,"lp."+MWF.language,{onRequestFailure:function(){MWF.xDesktop.requireApp(t,"lp.zh-cn",null,false)}.bind(this),onSuccess:function(){}.bind(this)},false);MWF.xDesktop.requireApp(t,i,function(){if(e)e(p)})},playMessageAudio:function(){var t=true;if(this.playMessageAudioTime){var e=new Date;var i=e.getTime()-this.playMessageAudioTime.getTime();if(i<5e3)t=false}if(t){if(!this.messageAudioNode){var s=MWF.defaultPath+"/xDesktop/$Layout/"+layout.desktop.options.style+"/sound/message.wav";var n=MWF.defaultPath+"/xDesktop/$Layout/"+layout.desktop.options.style+"/sound/message.mp3";this.messageAudioNode=new Element("div",{html:'<audio autoplay="autoplay" volume=0.6 preload="metadata"><source src="'+s+'" type="audio/x-wav"><source src="'+n+'" type="audio/mpeg"></source></audio>',styles:{display:"none"}}).inject(this.node);this.messageAudio=this.messageAudioNode.getFirst()}this.messageAudio.play();this.playMessageAudioTime=new Date}}});MWF.xDesktop.Layout.Taskitem=new Class({initialize:function(t,e){this.layout=e;this.app=t;this.node=new Element("div",{styles:this.layout.css.taskItemNode,title:this.app.options.title+(this.app.appId?"-"+this.app.appId:"")}).inject(this.layout.top.taskbar);this.iconNode=new Element("div",{styles:this.layout.css.taskItemIconNode}).inject(this.node);this.iconNode.setStyle("background-image","url("+this.app.options.icon+")");this.closeNode=new Element("div",{styles:this.layout.css.taskItemCloseNode}).inject(this.node);this.textNode=new Element("div",{styles:this.layout.css.taskItemTextNode}).inject(this.node);this.textNode.set("text",this.app.options.title);this.setTaskitemSize();this.setEvent()},setTaskitemSize:function(){var t=10;var e=5;var i=this.layout.top.taskbar.getSize();var s=this.layout.top.taskbar.getChildren();var n=0;if(s.length){var o=s[0].getStyles("border-left-width","border-right-width","margin-left","margin-right","padding-left","padding-right");for(var a=0;a<s.length;a++){s[a].setStyle("width","auto");n+=s[a].getSize().x+o["border-left-width"].toInt()+o["border-right-width"].toInt()+o["margin-left"].toInt()+o["margin-right"].toInt()+o["padding-left"].toInt()+o["padding-right"].toInt()}if(n>i.x-t){var l=(i.x-t)/s.length;var c=l-o["border-left-width"].toInt()-o["border-right-width"].toInt()-o["margin-left"].toInt()-o["margin-right"].toInt()-o["padding-left"].toInt()-o["padding-right"].toInt();s.each(function(t){t.setStyle("width",""+c+"px")})}else{s.each(function(t){t.setStyle("width","auto")})}}},setText:function(t){this.textNode.set("text",t||this.app.options.title)},setEvent:function(){this.textNode.addEvents({mouseover:function(){if(!this.layout.currentApp||this.layout.currentApp.taskitem!=this)this.node.setStyles(this.layout.css.taskItemNode_over)}.bind(this),mouseout:function(){if(!this.layout.currentApp||this.layout.currentApp.taskitem!=this)this.node.setStyles(this.layout.css.taskItemNode)}.bind(this),mousedown:function(){if(!this.layout.currentApp||this.layout.currentApp.taskitem!=this)this.node.setStyles(this.layout.css.taskItemNode_down)}.bind(this),mouseup:function(){if(!this.layout.currentApp||this.layout.currentApp.taskitem!=this)this.node.setStyles(this.layout.css.taskItemNode_over)}.bind(this),click:function(){if(this.layout.currentApp==this.app){this.app.minSize()}else{this.app.setCurrent()}}.bind(this)});this.iconNode.addEvents({mouseover:function(){if(!this.layout.currentApp||this.layout.currentApp.taskitem!=this)this.node.setStyles(this.layout.css.taskItemNode_over)}.bind(this),mouseout:function(){if(!this.layout.currentApp||this.layout.currentApp.taskitem!=this)this.node.setStyles(this.layout.css.taskItemNode)}.bind(this),mousedown:function(){if(!this.layout.currentApp||this.layout.currentApp.taskitem!=this)this.node.setStyles(this.layout.css.taskItemNode_down)}.bind(this),mouseup:function(){if(!this.layout.currentApp||this.layout.currentApp.taskitem!=this)this.node.setStyles(this.layout.css.taskItemNode_over)}.bind(this),click:function(){if(this.layout.currentApp==this.app){this.app.minSize()}else{this.app.setCurrent()}}.bind(this)});this.node.addEvents({mouseover:function(){this.closeNode.fade("in")}.bind(this),mouseout:function(){this.closeNode.fade("out")}.bind(this)});this.closeNode.addEvent("click",function(){this.app.close()}.bind(this))},selected:function(){this.node.setStyles(this.layout.css.taskItemNode_current)},unSelected:function(){this.node.setStyles(this.layout.css.taskItemNode)},changStyle:function(){if(this.node){if(!this.layout.currentApp||this.layout.currentApp.taskitem!=this){this.node.setStyles(this.layout.css.taskItemNode)}else{this.node.setStyles(this.layout.css.taskItemNode);this.node.setStyles(this.layout.css.taskItemNode_current)}}if(this.iconNode)this.iconNode.setStyles(this.layout.css.taskItemIconNode);if(this.textNode)this.textNode.setStyles(this.layout.css.taskItemTextNode)},destroy:function(){this.node.destroy()}});MWF.xDesktop.Layout.Top=new Class({initialize:function(t,e){this.layout=e;this.node=$(t);this.userApplicationsLog=[];this.sysApplicationsLog=[]},load:function(){this.loadMenuAction();this.loadSeparate();this.loadShowDesktop();this.loadClock();this.loadSeparate("right");this.loadUserMenu();this.loadStyleAction();this.loadUserChat();this.loadMessageAction();this.loadSeparate("right");this.loadTaskbar()},loadMenuAction:function(){this.loadMenuAction=new Element("div",{styles:this.layout.css.loadMenuAction,title:MWF.LP.desktop.menuAction}).inject(this.node);this.loadMenuAction.addEvent("click",function(){this.loadMenu()}.bind(this))},loadShowDesktop:function(){this.showDesktopAction=new Element("div",{styles:this.layout.css.showDesktopAction}).inject(this.node);this.showDesktopAction.addEvents({mouseover:function(){this.showDesktopAction.setStyles(this.layout.css.showDesktopAction_over)}.bind(this),mouseout:function(){this.showDesktopAction.setStyles(this.layout.css.showDesktopAction)}.bind(this),click:function(){var i=true;Object.each(this.layout.apps,function(t,e){if(!t.window.isHide){i=false;t.minSize()}}.bind(this));if(i){Object.each(this.layout.apps,function(t,e){t.setCurrent()}.bind(this))}}.bind(this)})},loadMenu:function(){this.createApplicationMenuArea();this.showApplicationMenu();window.setTimeout(function(){this.getApplicationsCatalogue(function(t){var e=this.layout.session.user;var n=[e.name,e.distinguishedName,e.id,e.unique];if(e.roleList)n=n.concat(e.roleList);if(e.groupList)n=n.concat(e.groupList);t.each(function(t,e){var i=true;if(t.allowList)i=t.allowList.length?t.allowList.isIntersect(n):true;var s=false;if(t.denyList)s=t.denyList.length?t.denyList.isIntersect(n)!==-1:false;if(!s&&i||MWF.AC.isAdministrator()){this.createApplicationMenu(t,e)}}.bind(this));this.getComponentList(function(t){t.data.each(function(t,e){if(t.visible){var i=t.allowList.length?t.allowList.isIntersect(n):true;var s=t.denyList.length?t.denyList.isIntersect(n):false;if(!s&&i||MWF.AC.isAdministrator()){this.createApplicationMenu(t,e)}}}.bind(this))}.bind(this));var i=new MWF.xDesktop.Actions.RestActions("/xDesktop/Actions/action.json","x_portal_assemble_surface");i.invoke({name:"listPortalApplication",success:function(t){if(t.data){t.data.each(function(t){this.createPortalAppMenu(t)}.bind(this))}}.bind(this)})}.bind(this));this.getProcessApplications(function(t){}.bind(this))}.bind(this),0)},showApplicationMenu:function(){this.applicationMenuAreaMark.fade(.8);this.applicationMenuArea.fade("in")},closeApplicationMenu:function(){if(this.applicationMenuSearchBar)this.closeApplicationMenuSearchBar();if(!this.isApplicationMenuScroll){this.applicationMenuAreaMark.destroy();this.applicationMenuArea.destroy();this.applicationMenuFxScroll=null;this.userApplicationsLog=[];this.sysApplicationsLog=[];this.layout.removeEvent("resize",this.resizeApplicationMenuSizeFun)}this.currentApplicationMenuContent="app";this.isApplicationMenuScroll=false;if(this.closeApplicationMenuFun)document.body.removeEvent("keydown",this.closeApplicationMenuFun)},closeApplicationMenuEsc:function(t){if(t.key==="esc"){if(!this.applicationMenuSearchBar){this.closeApplicationMenu()}}},createCMSAppMenu:function(e){var t=new Element("div",{styles:this.layout.css.applicationMenuNode,title:e.appName}).inject(this.applicationMenuProcessArea);this.userApplicationsLog.push({node:t,py:e.appName.toPY().toLowerCase(),name:e.appName.toLowerCase(),first:e.appName.toPYFirst().toLowerCase()});var i=new Element("div",{styles:this.layout.css.applicationMenuIconNode}).inject(t);var s="";if(e.appIcon){s="url(data:image/png;base64,"+e.appIcon+")"}else{s="url(/x_component_cms_Index/$Main/default/icon/column.png)"}i.setStyle("background-image",s);new Element("div",{styles:this.layout.css.applicationMenuTextNode,text:e.appName}).inject(t);t.addEvent("click",function(t){this.layout.openCMSApp(t,e);this.closeApplicationMenu()}.bind(this));t.makeLnk({par:{icon:s,title:e.name,par:'cms.Module#{"columnId": "'+e.id+'", "appId": "cms.Module'+e.id+'"}'},onStart:function(){this.applicationMenuAreaMark.fade("out");this.applicationMenuArea.fade("out")}.bind(this),onComplete:function(){this.showApplicationMenu()}.bind(this)})},createPortalAppMenu:function(e){var t=new Element("div",{styles:this.layout.css.applicationMenuNode,title:e.name}).inject(this.applicationMenuAppIconArea);this.userApplicationsLog.push({node:t,py:e.name.toPY().toLowerCase(),name:e.name.toLowerCase(),first:e.name.toPYFirst().toLowerCase()});var i=new Element("div",{styles:this.layout.css.applicationMenuIconNode}).inject(t);var s="";if(e.icon){s="url(data:image/png;base64,"+e.icon+")"}else{s="url(/x_component_portal_PortalExplorer/$Main/default/icon/application.png)"}i.setStyle("background-image",s);new Element("div",{styles:this.layout.css.applicationMenuTextNode,text:e.name}).inject(t);t.addEvent("click",function(t){this.layout.openPortalApp(t,e);this.closeApplicationMenu()}.bind(this));t.makeLnk({par:{icon:s,title:e.name,par:'portal.Portal#{"portalId": "'+e.id+'", "appId": "portal.Portal'+e.id+'"}'},onStart:function(){this.applicationMenuAreaMark.fade("out");this.applicationMenuArea.fade("out")}.bind(this),onComplete:function(){this.showApplicationMenu()}.bind(this)})},createQueryAppMenu:function(e){var t=new Element("div",{styles:this.layout.css.applicationMenuNode,title:e.name}).inject(this.applicationMenuProcessArea);this.userApplicationsLog.push({node:t,py:e.name.toPY().toLowerCase(),name:e.name.toLowerCase(),first:e.name.toPYFirst().toLowerCase()});var i=new Element("div",{styles:this.layout.css.applicationMenuIconNode}).inject(t);var s="";if(e.icon){s="url(data:image/png;base64,"+e.icon+")"}else{s="url(/x_component_query_Query/$Main/appicon.png)"}i.setStyle("background-image",s);new Element("div",{styles:this.layout.css.applicationMenuTextNode,text:e.name}).inject(t);t.addEvent("click",function(t){this.layout.openQueryApp(t,e);this.closeApplicationMenu()}.bind(this));t.makeLnk({par:{icon:s,title:e.name,par:'query.Query#{"id": "'+e.id+'", "appId": "query.Query'+e.id+'"}'},onStart:function(){this.applicationMenuAreaMark.fade("out");this.applicationMenuArea.fade("out")}.bind(this),onComplete:function(){this.showApplicationMenu()}.bind(this)})},createProcessAppMenu:function(e){var t=new Element("div",{styles:this.layout.css.applicationMenuNode,title:e.name}).inject(this.applicationMenuProcessArea);this.userApplicationsLog.push({node:t,py:e.name.toPY().toLowerCase(),name:e.name.toLowerCase(),first:e.name.toPYFirst().toLowerCase()});var i=new Element("div",{styles:this.layout.css.applicationMenuIconNode}).inject(t);var s="";if(e.icon){s="url(data:image/png;base64,"+e.icon+")"}else{s="url(/x_component_process_ApplicationExplorer/$Main/default/icon/application.png)"}i.setStyle("background-image",s);new Element("div",{styles:this.layout.css.applicationMenuTextNode,text:e.name}).inject(t);t.addEvent("click",function(t){this.layout.openProcessApp(t,e);this.closeApplicationMenu()}.bind(this));t.makeLnk({par:{icon:s,title:e.name,par:'process.Application#{"id": "'+e.id+'", "appId": "process.Application'+e.id+'"}'},onStart:function(){this.applicationMenuAreaMark.fade("out");this.applicationMenuArea.fade("out")}.bind(this),onComplete:function(){this.showApplicationMenu()}.bind(this)})},createApplicationMenu:function(e,t){var i=new Element("div",{styles:this.layout.css.applicationMenuNode,title:e.title}).inject(this.applicationMenuAppIconArea);this.sysApplicationsLog.push({node:i,py:e.title.toPY().toLowerCase(),name:e.title.toLowerCase(),first:e.title.toPYFirst().toLowerCase()});var s=new Element("div",{styles:this.layout.css.applicationMenuIconNode}).inject(i);var n="/x_component_"+e.path.replace(/\./g,"_")+"/$Main/"+e.iconPath;s.setStyle("background-image","url("+n+")");new Element("div",{styles:this.layout.css.applicationMenuTextNode,text:e.title}).inject(i);i.addEvent("click",function(t){this.layout.openApplication(t,e.path);this.closeApplicationMenu()}.bind(this));i.makeLnk({par:{icon:n,title:e.title,par:e.path},onStart:function(){this.applicationMenuAreaMark.fade("out");this.applicationMenuArea.fade("out")}.bind(this),onComplete:function(){this.showApplicationMenu()}.bind(this)});var o=e.path},createApplicationWidgetMenu:function(e,t,i,s){var n=new Element("div",{styles:this.layout.css.widgetMenuNode,title:t}).inject(this.applicationMenuWidgetArea);var o=new Element("div",{styles:this.layout.css.widgetMenuIconNode}).inject(n);var i="/x_component_"+s.replace(/\./g,"_")+"/$"+e+"/"+i;o.setStyle("background-image","url("+i+")");new Element("div",{styles:this.layout.css.applicationMenuTextNode,text:t}).inject(n);n.addEvent("click",function(t){this.layout.openWidget(t,e,s);this.closeApplicationMenu()}.bind(this))},createApplicationMenuArea:function(){var t=MWF.xDesktop.zIndexPool.zIndex;this.applicationMenuAreaMark=new Element("iframe",{styles:this.layout.css.applicationMenuAreaMark}).inject(this.layout.node);this.applicationMenuAreaMark.setStyle("z-index",t);this.applicationMenuArea=new Element("div",{styles:this.layout.css.applicationMenuArea}).inject(this.layout.node);this.applicationMenuArea.setStyle("z-index",t+1);this.applicationMenuLeftAction=new Element("div",{styles:this.layout.css.applicationMenuLeftAction}).inject(this.applicationMenuArea);this.applicationMenuRightAction=new Element("div",{styles:this.layout.css.applicationMenuRightAction}).inject(this.applicationMenuArea);this.applicationMenuScrollArea=new Element("div",{styles:this.layout.css.applicationMenuScrollArea}).inject(this.applicationMenuArea);this.applicationMenuContentArea=new Element("div",{styles:this.layout.css.applicationMenuContentArea}).inject(this.applicationMenuScrollArea);this.applicationMemuAppContent=new Element("div",{styles:this.layout.css.applicationMemuAppContent}).inject(this.applicationMenuContentArea);this.applicationMenuAppTitleArea=new Element("div",{styles:this.layout.css.applicationMenuAppTitleArea,text:MWF.LP.desktop.application}).inject(this.applicationMemuAppContent);this.applicationMenuAppIconScrollArea=new Element("div",{styles:this.layout.css.applicationMenuAppIconScrollArea}).inject(this.applicationMemuAppContent);this.applicationMenuAppIconArea=new Element("div",{styles:this.layout.css.applicationMenuAppIconArea}).inject(this.applicationMenuAppIconScrollArea);this.applicationMemuProcessContent=new Element("div",{styles:this.layout.css.applicationMemuProcessContent}).inject(this.applicationMenuContentArea);this.applicationMenuProcessTitleArea=new Element("div",{styles:this.layout.css.applicationMenuProcessTitleArea,text:MWF.LP.desktop.process}).inject(this.applicationMemuProcessContent);this.applicationMenuProcessScrollArea=new Element("div",{styles:this.layout.css.applicationMenuProcessScrollArea}).inject(this.applicationMemuProcessContent);this.applicationMenuProcessArea=new Element("div",{styles:this.layout.css.applicationMenuProcessArea}).inject(this.applicationMenuProcessScrollArea);this.setApplicationMenuSize();this.setApplicationMenuEvent()},setApplicationMenuSize:function(){this.resizeApplicationMenuSize();this.resizeApplicationMenuSizeFun=this.resizeApplicationMenuSize.bind(this);this.layout.addEvent("resize",this.resizeApplicationMenuSizeFun)},resizeApplicationMenuSize:function(){var t=this.applicationMenuScrollArea.getSize();this.applicationMemuAppContent.setStyle("width",""+t.x+"px");this.applicationMemuProcessContent.setStyle("width",""+t.x+"px");var e=t.x*2;this.applicationMenuContentArea.setStyle("width",""+e+"px");var i=this.applicationMenuArea.getSize();var s=this.applicationMenuAppTitleArea.getSize();var n=this.applicationMenuAppTitleArea.getStyle("margin-top").toInt();var o=this.applicationMenuAppTitleArea.getStyle("margin-bottom").toInt();var a=this.applicationMenuAppIconScrollArea.getStyle("margin-top").toInt();var l=this.applicationMenuAppIconScrollArea.getStyle("margin-bottom").toInt();var c=i.y-s.y-n-o-a-l;this.applicationMenuAppIconScrollArea.setStyle("height",""+c+"px");s=this.applicationMenuProcessTitleArea.getSize();n=this.applicationMenuProcessTitleArea.getStyle("margin-top").toInt();o=this.applicationMenuProcessTitleArea.getStyle("margin-bottom").toInt();a=this.applicationMenuProcessScrollArea.getStyle("margin-top").toInt();l=this.applicationMenuProcessScrollArea.getStyle("margin-bottom").toInt();c=i.y-s.y-n-o-a-l;this.applicationMenuProcessScrollArea.setStyle("height",""+c+"px")},setApplicationMenuEvent:function(){MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.applicationMenuAppIconScrollArea,{style:"xDesktop_Menu",where:"after",distance:30,friction:4,axis:{x:false,y:true},onScrollStart:function(){this.isApplicationMenuScroll=true}.bind(this)});new MWF.widget.ScrollBar(this.applicationMenuProcessScrollArea,{style:"xDesktop_Menu",where:"after",distance:30,friction:4,axis:{x:false,y:true},onScrollStart:function(){this.isApplicationMenuScroll=true}.bind(this)})}.bind(this));this.applicationMenuRightAction.addEvent("click",function(t){this.closeApplicationMenuSearchBar();if(!this.currentApplicationMenuContent)this.currentApplicationMenuContent="app";var e="";var i=null;var s=null;if(this.currentApplicationMenuContent=="app"){i=this.applicationMemuProcessContent;e="process";s=this.applicationMemuAppContent}if(this.currentApplicationMenuContent=="process"){i=this.applicationMemuAppContent;e="app";s=this.applicationMemuProcessContent}if(!this.applicationMenuFxScroll)this.applicationMenuFxScroll=new Fx.Scroll(this.applicationMenuScrollArea,{wheelStops:false});i.inject(s,"after");this.applicationMenuFxScroll.set(0);this.applicationMenuFxScroll.toElement(i,"x").chain(function(){}.bind(this));this.currentApplicationMenuContent=e;t.stopPropagation()}.bind(this));this.applicationMenuLeftAction.addEvent("click",function(t){this.closeApplicationMenuSearchBar();if(!this.currentApplicationMenuContent)this.currentApplicationMenuContent="app";var e="";var i=null;var s=null;if(this.currentApplicationMenuContent=="app"){i=this.applicationMemuProcessContent;e="process";s=this.applicationMemuAppContent}if(this.currentApplicationMenuContent=="process"){i=this.applicationMemuAppContent;e="app";s=this.applicationMemuProcessContent}if(!this.applicationMenuFxScroll)this.applicationMenuFxScroll=new Fx.Scroll(this.applicationMenuScrollArea,{wheelStops:false});i.inject(s,"before");this.applicationMenuFxScroll.set(this.applicationMenuScrollArea.getScrollSize().x);this.applicationMenuFxScroll.toElement(i);this.currentApplicationMenuContent=e;t.stopPropagation()}.bind(this));this.applicationMenuArea.addEvent("click",function(){this.closeApplicationMenu()}.bind(this));this.closeApplicationMenuFun=this.closeApplicationMenuEsc.bind(this);document.body.addEvent("keydown",this.closeApplicationMenuFun);this.showApplicationSearchFun=this.showApplicationSearch.bind(this);document.body.addEvent("keydown",this.showApplicationSearchFun)},showApplicationSearch:function(t){if(t.key==="esc"){if(this.applicationMenuSearchBar)this.closeApplicationMenuSearchBar()}else{if(!this.applicationMenuSearchBar)this.createApplicationMenuSearchBar(t)}},closeApplicationMenuSearchBar:function(){if(this.applicationMenuSearchBar){this.applicationMenuSearchBar.destroy();this.applicationMenuSearchBar=null;if(this.currentApplicationMenuContent==="process"||!this.currentApplicationMenuContent){this.userApplicationsLog.each(function(t){t.node.setStyle("display","block")}.bind(this))}if(this.currentApplicationMenuContent==="app"){this.sysApplicationsLog.each(function(t){t.node.setStyle("display","block")}.bind(this))}}},createApplicationMenuSearchBar:function(t){this.applicationMenuSearchBar=new Element("div",{styles:this.layout.css.applicationMenuSearchBar}).inject(this.applicationMenuArea);this.applicationMenuSearchBarBox=new Element("div",{styles:this.layout.css.applicationMenuSearchBarBox}).inject(this.applicationMenuSearchBar);this.applicationMenuSearchBarClose=new Element("div",{styles:this.layout.css.applicationMenuSearchBarClose}).inject(this.applicationMenuSearchBarBox);this.applicationMenuSearchBarInputBox=new Element("div",{styles:this.layout.css.applicationMenuSearchBarInputBox}).inject(this.applicationMenuSearchBarBox);this.applicationMenuSearchBarInput=new Element("input",{styles:this.layout.css.applicationMenuSearchBarInput}).inject(this.applicationMenuSearchBarInputBox);this.applicationMenuSearchBarInput.focus();this.applicationMenuSearchBarInput.addEvent("keydown",function(t){if(t.key==="esc"){this.closeApplicationMenuSearchBar()}if(t.key==="enter"){this.doApplicationMenuSearch()}t.stopPropagation()}.bind(this));this.applicationMenuSearchBarInput.addEvent("click",function(t){t.stopPropagation()}.bind(this));this.applicationMenuSearchBarClose.addEvent("click",function(t){this.closeApplicationMenuSearchBar()}.bind(this))},doApplicationMenuSearch:function(){var e=this.applicationMenuSearchBarInput.get("value").toLowerCase();if(e){if(this.currentApplicationMenuContent==="process"||!this.currentApplicationMenuContent){this.userApplicationsLog.each(function(t){if(t.py.indexOf(e)===-1&&t.first.indexOf(e)===-1&&t.name.indexOf(e)===-1){t.node.setStyle("display","none")}else{t.node.setStyle("display","block")}}.bind(this))}if(this.currentApplicationMenuContent==="app"){this.sysApplicationsLog.each(function(t){if(t.py.indexOf(e)===-1&&t.first.indexOf(e)===-1&&t.name.indexOf(e)===-1){t.node.setStyle("display","none")}else{t.node.setStyle("display","block")}}.bind(this))}}},getApplicationsCatalogue:function(e){var t=MWF.defaultPath+"/xDesktop/$Layout/applications.json";MWF.getJSON(t,function(t){if(e)e(t)}.bind(this))},getProcessApplications:function(t){action=new MWF.xDesktop.Actions.RestActions("/xDesktop/Actions/action.json","x_processplatform_assemble_surface");action.invoke({name:"listApplication",success:function(t){if(t.data){t.data.each(function(t){this.createProcessAppMenu(t)}.bind(this))}}.bind(this)});action=new MWF.xDesktop.Actions.RestActions("/xDesktop/Actions/action.json","x_cms_assemble_control");action.invoke({name:"listCMSApplication",success:function(t){if(t.data){t.data.each(function(t){t.name=t.appName;t.icon=t.appIcon;this.createCMSAppMenu(t)}.bind(this))}}.bind(this)});action=MWF.Actions.get("x_query_assemble_surface");action.listQuery(function(t){if(t.data){t.data.each(function(t){this.createQueryAppMenu(t)}.bind(this))}}.bind(this))},getComponentList:function(e){var t=new MWF.xDesktop.Actions.RestActions("/xDesktop/Actions/action.json","x_component_assemble_control");t.invoke({name:"listComponent",success:function(t){if(e)e(t)}.bind(this)})},loadConfigAction:function(){this.configActionNode=new Element("div",{styles:this.layout.css.configActionNode,title:MWF.LP.desktop.configAction}).inject(this.node);this.configActionNode.addEvent("click",function(){alert("show config")})},loadSeparate:function(t){var e=new Element("div.separateNode",{styles:this.layout.css.separateNode}).inject(this.node);if(t)e.setStyle("float",t)},loadTaskbar:function(){this.taskbar=new Element("div",{styles:this.layout.css.taskbar}).inject(this.node)},loadUserChat:function(){this.userChatNode=new Element("div",{styles:this.layout.css.userChatNode,title:MWF.LP.desktop.userChat}).inject(this.node);this.userChatNode.addEvents({mouseover:function(){if(this.layout.css.userChatNode_over)this.userChatNode.setStyles(this.layout.css.userChatNode_over)}.bind(this),mouseout:function(){this.userChatNode.setStyles(this.layout.css.userChatNode)}.bind(this)});this.userChatNode.addEvent("click",function(t){this.userConfig();return false;if(!this.socket||this.layout.socket.webSocket.readyState!=1){this.layout.socket=new MWF.xDesktop.WebSocket}this.layout.openApplication(t,"IM");var s=this.layout.widgets["IMIMWidget"];if(s){if(s.unreadNode){var n=this.layout.apps["Chat"];if(n){Object.each(s.unShowMessage,function(t,e){if(t.length){var i=n.dialogues[e];if(!i){s.getPerson(t[0].from,function(){i=n.addDialogue(s.owner,[s.users[t[0].from]])}.bind(this))}}}.bind(this))}var e=this;layout.desktop.openApplication(t,"Chat",{onPostLoad:function(){Object.each(s.unShowMessage,function(t,e){if(t.length){s.getPerson(t[0].from,function(){dialogue=this.addDialogue(s.owner,[s.users[t[0].from]])}.bind(this))}}.bind(this))}})}}}.bind(this))},userConfig:function(t){this.layout.openApplication(t,"Profile")},logout:function(){this.layout.isLogout=true;if(!this.notRecordStatus){this.layout.recordDesktopStatus(function(){this.authentication.logout()}.bind(this.layout))}else{this.authentication.logout()}},loadStyleAction:function(){this.styleActionNode=new Element("div",{styles:this.layout.css.styleActionNode,title:MWF.LP.desktop.styleAction}).inject(this.node);this.styleActionNode.addEvents({mouseover:function(){if(this.layout.css.styleActionNode_over)this.styleActionNode.setStyles(this.layout.css.styleActionNode_over)}.bind(this),mouseout:function(){this.styleActionNode.setStyles(this.layout.css.styleActionNode)}.bind(this)});this.setChangeStyle()},setChangeStyle:function(){if(!this.styleMenu){this.styleMenu=new MWF.xDesktop.Menu(this.styleActionNode,{event:"click",style:"desktopStyle",offsetX:-60,offsetY:10,container:this.layout.node,onQueryShow:function(){this.styleMenu.items.each(function(t){if(this.layout.options.style==t.styleName){t.setDisable(true)}else{t.setDisable(false)}}.bind(this))}.bind(this)});this.styleMenu.load();debugger;MWF.UD.getPublicData("indexThemes",function(s){MWF.getJSON(this.layout.path+"styles.json",function(t){t.each(function(t){if(!s||s.indexOf(t.style)!=-1){var e=MWF.defaultPath+"/xDesktop/$Layout/"+t.style+"/preview.jpg";var i=this.styleMenu.addMenuItem(t.title,"click",function(){this.changeLayoutStyle(t.style)}.bind(this),e);i.styleName=t.style}}.bind(this))}.bind(this));MWF.UD.getPublicData("indexStyleList",function(t){this.indexStyleList=t;if(!this.indexStyleList)this.indexStyleList={styleList:[]};this.indexStyleList.styleList.each(function(t){if(t.enabled){var e=t.preview;var i=this.styleMenu.addMenuItem(t.title,"click",function(){this.changeLayoutStyle(t.id,true)}.bind(this),e);i.styleName=t.id}}.bind(this))}.bind(this))}.bind(this))}},changeLayoutStyle:function(t,e){MWF.UD.deleteData("layoutDesktop",function(){this.layout.changStyle(t,e)}.bind(this))},loadMessageAction:function(){this.messageActionNode=new Element("div",{styles:this.layout.css.messageActionNode,title:MWF.LP.desktop.showMessage}).inject(this.node);this.messageActionNode.addEvents({mouseover:function(){if(this.layout.css.messageActionNode_over)this.messageActionNode.setStyles(this.layout.css.messageActionNode_over)}.bind(this),mouseout:function(){this.messageActionNode.setStyles(this.layout.css.messageActionNode)}.bind(this)});this.layout.message=new MWF.xDesktop.Message(this.layout);this.layout.message.load();this.messageActionNode.addEvent("click",function(){this.showDesktopMessage()}.bind(this))},showDesktopMessage:function(){if(!this.layout.message.isShow){this.layout.message.show()}},loadUserMenu:function(){this.userMenuNode=new Element("div",{styles:this.layout.css.userMenuNode,title:MWF.LP.desktop.userMenu}).inject(this.node);this.userMenuNode.addEvents({mouseover:function(){if(this.layout.css.userMenuNode_over)this.userMenuNode.setStyles(this.layout.css.userMenuNode_over)}.bind(this),mouseout:function(){this.userMenuNode.setStyles(this.layout.css.userMenuNode)}.bind(this)});this.userMenu=new MWF.xDesktop.Menu(this.userMenuNode,{event:"click",style:"desktopUser",offsetX:-10,offsetY:10,container:this.layout.node});this.userMenu.load();var t=MWF.defaultPath+"/xDesktop/$Layout/"+this.layout.options.style+"/usermenu/config.png";this.userMenu.addMenuItem(MWF.LP.desktop.userConfig,"click",function(t){this.userConfig(t)}.bind(this),t);this.userMenu.addMenuLine();t=MWF.defaultPath+"/xDesktop/$Layout/"+this.layout.options.style+"/usermenu/logout.png";this.userMenu.addMenuItem(MWF.LP.desktop.logout,"click",function(){this.logout()}.bind(this),t)},loadClock:function(){this.clockNode=new Element("div",{styles:this.layout.css.clockNode}).inject(this.node);this.setTime()},setTime:function(){var t=new Date;var e=1e3-t.getMilliseconds();var i=60-t.getSeconds();var s=t.format("%Y/%m/%d#%H:%M");dl=s.split("#");this.clockNode.set("html",dl[1]+"<br/>"+dl[0]);window.setTimeout(this.setTime.bind(this),i*1e3+e)},changStyle:function(){if(this.loadMenuAction)this.loadMenuAction.setStyles(this.layout.css.loadMenuAction);if(this.configActionNode)this.configActionNode.setStyles(this.layout.css.configActionNode);var t=this.layout.css.separateNode;delete t["float"];this.node.getElements(".separateNode").setStyles(t);if(this.userChatNode)this.userChatNode.setStyles(this.layout.css.userChatNode);if(this.styleActionNode)this.styleActionNode.setStyles(this.layout.css.styleActionNode);if(this.messageActionNode)this.messageActionNode.setStyles(this.layout.css.messageActionNode);if(this.clockNode)this.clockNode.setStyles(this.layout.css.clockNode);if(this.userMenuNode)this.userMenuNode.setStyles(this.layout.css.userMenuNode);if(this.styleActionNode)this.styleActionNode.setStyles(this.layout.css.styleActionNode);if(this.userActionNode)this.userActionNode.setStyles(this.layout.css.userActionNode);if(this.taskbar)this.taskbar.setStyles(this.layout.css.taskbar);if(this.userPanel)this.userPanel.changStyle(this.layout.options.style)}});MWF.xDesktop.Layout.Navi=new Class({initialize:function(t,e){this.layout=e;this.node=$(t);this.navis=[]},load:function(){this.createNaviArea();this.loadNavis()},createNaviArea:function(){this.naviNodeBottomArea=new Element("div",{styles:this.layout.css.naviNodeBottomArea}).inject(this.node);this.naviNodeArea=new Element("div",{styles:this.layout.css.naviNodeArea}).inject(this.node)},editQuickNavi:function(){},loadNavis:function(){MWF.getJSON(this.layout.path+"quickStart.json",function(t){t.navi.each(function(t){this.navis.push(this.createNaviNode(t))}.bind(this))}.bind(this))},createNaviNode:function(t){var e=new Element("div",{styles:this.layout.css.mainNaviNode}).inject(this.naviNodeArea);e.store("navi",t);var i=new Element("div",{styles:this.layout.css.mainNaviIconNode}).inject(e);i.setStyle("background-image","url("+MWF.defaultPath+"/xDesktop/$Layout/"+this.layout.options.style+"/navi/"+t.icon+")");new Element("div",{styles:this.layout.css.mainNaviTextNode,text:t.title}).inject(e);var s=this;e.addEvents({mouseover:function(){var t=this.retrieve("navi");this.setStyle("background","#CCC");var e=t.icon.replace(".","_over.");this.getFirst("div").setStyle("background-image","url("+MWF.defaultPath+"/xDesktop/$Layout/"+s.layout.options.style+"/navi/"+e+")");this.getLast("div").setStyle("color","#444")},mouseout:function(){this.setStyle("background","transparent");var t=this.retrieve("navi");this.setStyle("background","transparent");this.getFirst("div").setStyle("background-image","url("+MWF.defaultPath+"/xDesktop/$Layout/"+s.layout.options.style+"/navi/"+t.icon+")");this.getLast("div").setStyle("color","#FFF")},mousedown:function(){this.setStyle("background","#FFF")},mouseup:function(){this.setStyle("background","#CCC")},click:function(t){var e=this.retrieve("navi");s.layout.openApplication(t,e.action)}});return e},changStyle:function(){if(this.naviNodeBottomArea)this.naviNodeBottomArea.setStyles(this.layout.css.naviNodeBottomArea);if(this.naviNodeArea)this.naviNodeArea.setStyles(this.layout.css.naviNodeArea);this.navis.each(function(t){t.setStyles(this.layout.css.mainNaviNode);t.getFirst("div").setStyles(this.layout.css.mainNaviIconNode);t.getLast("div").setStyles(this.layout.css.mainNaviTextNode)}.bind(this))}});MWF.xDesktop.zIndexPool={zIndex:100,applyZindex:function(){var t=this.zIndex;this.zIndex=this.zIndex+2;return t}};