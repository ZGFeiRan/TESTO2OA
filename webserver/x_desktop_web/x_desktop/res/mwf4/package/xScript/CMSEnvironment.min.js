MWF.xScript=MWF.xScript||{};MWF.xScript.CMSEnvironment=function(t){var i=t.data;var f=t.form;var a=t.forms;this.library=COMMON;var n=function(t){return new MWF.xScript.CMSJSONData(t,function(t,i,n){var e={getKey:function(){return i},getParent:function(){return n}};while(e&&!a[e.getKey()])e=e.getParent();if(e)if(e.getKey())if(a[e.getKey()])a[e.getKey()].resetData()})};this.setData=function(t){this.data=n(t);this.data.save=function(i){form.documentAction.saveData(function(t){if(i)i()}.bind(this),null,document.id,jData)}};this.setData(i);this.documentContext={getDocument:function(){return t.document},getControl:function(){return t.control},getAttachmentList:function(){return t.attachmentList}};this.Dict=MWF.xScript.createCMSDict(f.json.application);var s=null;var r=function(){if(!s){MWF.require("MWF.xScript.Actions.UnitActions",null,false);s=new MWF.xScript.Actions.UnitActions}};var u=function(t){var i=typeOf(t);if(i==="array"){var n=[];t.each(function(t){n.push(typeOf(t)==="object"?t.distinguishedName||t.id||t.unique||t.name:t)});return n}else{return[i==="object"?t.distinguishedName||t.id||t.unique||t.name:t]}};this.org={getGroup:function(t){r();var i={groupList:u(t)};var n=null;s.listGroup(i,function(t){n=t.data},null,false);return n&&n.length===1?n[0]:n},listSubGroup:function(t,i){r();var n={groupList:u(t)};var e=null;if(i){s.listSubGroupNested(n,function(t){e=t.data},null,false)}else{s.listSubGroupDirect(n,function(t){e=t.data},null,false)}return e},listSupGroup:function(t,i){r();var n={groupList:u(t)};var e=null;if(i){s.listSupGroupNested(n,function(t){e=t.data},null,false)}else{s.listSupGroupDirect(n,function(t){e=t.data},null,false)}return e},listGroupWithPerson:function(t){r();var i={personList:u(t)};var n=null;s.listGroupWithPerson(i,function(t){n=t.data},null,false);return n},groupHasRole:function(t,i){r();nameFlag=typeOf(t)==="object"?t.distinguishedName||t.id||t.unique||t.name:t;var n={group:nameFlag,roleList:u(i)};var e=false;s.groupHasRole(n,function(t){e=t.data.value},null,false);return e},getRole:function(t){r();var i={roleList:u(t)};var n=null;s.listRole(i,function(t){n=t.data},null,false);return n&&n.length===1?n[0]:n},listRoleWithPerson:function(t){r();var i={personList:u(t)};var n=null;s.listRoleWithPerson(i,function(t){n=t.data},null,false);return n},personHasRole:function(t,i){r();nameFlag=typeOf(t)==="object"?t.distinguishedName||t.id||t.unique||t.name:t;var n={person:nameFlag,roleList:u(i)};var e=false;s.personHasRole(n,function(t){e=t.data.value},null,false);return e},getPerson:function(t){r();var i={personList:u(t)};var n=null;s.listPerson(i,function(t){n=t.data},null,false);return n&&n.length===1?n[0]:n},listSubPerson:function(t,i){r();var n={personList:u(t)};var e=null;if(i){s.listPersonSubNested(n,function(t){e=t.data},null,false)}else{s.listPersonSubDirect(n,function(t){e=t.data},null,false)}return e},listSupPerson:function(t,i){r();var n={personList:u(t)};var e=null;if(i){s.listPersonSupNested(n,function(t){e=t.data},null,false)}else{s.listPersonSupDirect(n,function(t){e=t.data},null,false)}return e},listPersonWithGroup:function(t){r();var i={groupList:u(t)};var n=null;s.listPersonWithGroup(i,function(t){n=t.data},null,false);return n},listPersonWithRole:function(t){r();var i={roleList:u(t)};var n=null;s.listPersonWithRole(i,function(t){n=t.data},null,false);return n},listPersonWithIdentity:function(t){r();var i={dentityList:u(t)};var n=null;s.listPersonWithIdentity(i,function(t){n=t.data},null,false);return n},listPersonWithUnit:function(t,i){r();var n={unitList:u(t)};var e=null;if(i){s.listPersonWithUnitNested(n,function(t){e=t.data},null,false)}else{s.listPersonWithUnitDirect(n,function(t){e=t.data},null,false)}return e},appendPersonAttribute:function(t,i,n){r();var e=typeOf(t)==="object"?t.distinguishedName||t.id||t.unique||t.name:t;var a={attributeList:n,name:i,person:e};s.appendPersonAttribute(a,function(t){if(t.data.value){if(success)success()}else{if(failure)failure(null,"","append values failed")}},function(t,i,n){if(failure)failure(t,i,n)},false)},setPersonAttribute:function(t,i,n){r();var e=typeOf(t)==="object"?t.distinguishedName||t.id||t.unique||t.name:t;var a={attributeList:n,name:i,person:e};s.setPersonAttribute(a,function(t){if(t.data.value){if(success)success()}else{if(failure)failure(null,"","append values failed")}},function(t,i,n){if(failure)failure(t,i,n)},false)},getPersonAttribute:function(t,i){r();var n=typeOf(t)==="object"?t.distinguishedName||t.id||t.unique||t.name:t;var e={name:i,person:n};var a=null;s.getPersonAttribute(e,function(t){a=t.data.attributeList},null,false);return a},listPersonAttributeName:function(t){r();var i={personList:u(t)};var n=null;s.listPersonAttributeName(i,function(t){n=t.data.nameList},null,false);return n},listPersonAllAttribute:function(t){r();var i={personList:u(t)};var n=null;s.listPersonAllAttribute(i,function(t){n=t.data},null,false);return n},getIdentity:function(t){r();var i={identityList:u(t)};var n=null;s.listIdentity(i,function(t){n=t.data},null,false);return n&&n.length===1?n[0]:n},listIdentityWithPerson:function(t){r();var i={personList:u(t)};var n=null;s.listIdentityWithPerson(i,function(t){n=t.data},null,false);return n},listIdentityWithUnit:function(t,i){r();var n={unitList:u(t)};var e=null;if(i){s.listIdentityWithUnitNested(n,function(t){e=t.data},null,false)}else{s.listIdentityWithUnitDirect(n,function(t){e=t.data},null,false)}return e},getUnit:function(t){r();var i={unitList:u(t)};var n=null;s.listUnit(i,function(t){n=t.data},null,false);return n&&n.length===1?n[0]:n},listSubUnit:function(t,i){r();var n={unitList:u(t)};var e=null;if(i){s.listUnitSubNested(n,function(t){e=t.data},null,false)}else{s.listUnitSubDirect(n,function(t){e=t.data},null,false)}return e},listSupUnit:function(t,i){r();var n={unitList:u(t)};var e=null;if(i){s.listUnitSupNested(n,function(t){e=t.data},null,false)}else{s.listUnitSupDirect(n,function(t){e=t.data},null,false)}return e},getUnitByIdentity:function(t,i){r();var n="current";var e;if(i){if(typeOf(i)==="string")n="type";if(typeOf(i)==="number")n="level"}switch(n){case"current":var a={identity:typeOf(t)==="object"?t.distinguishedName||t.id||t.unique||t.name:t,level:i};s.getUnitWithIdentityAndLevel(a,function(t){e=t.data},null,false);break;case"type":var a={identity:typeOf(t)==="object"?t.distinguishedName||t.id||t.unique||t.name:t,type:i};s.getUnitWithIdentityAndType(a,function(t){e=t.data},null,false);break;case"level":var a={identityList:u(t)};s.listUnitWithIdentity(a,function(t){e=t.data},null,false);break}return e},listAllSupUnitWithIdentity:function(t){r();var i={identityList:u(t)};var n=null;s.listUnitSupNestedWithIdentity(i,function(t){n=t.data},null,false);return n},listUnitWithPerson:function(t){r();var i={personList:u(t)};var n=null;s.listUnitWithPerson(i,function(t){n=t.data},null,false);return n},listAllSupUnitWithPerson:function(t){r();var i={personList:u(t)};var n=null;s.listUnitSupNestedWithPerson(i,function(t){n=t.data},null,false);return n},listUnitWithAttribute:function(t,i){r();var n={name:t,attribute:i};var e=null;s.listUnitWithAttribute(n,function(t){e=t.data},null,false);return e},listUnitWithDuty:function(t,i){r();var n={name:"",identity:typeOf(i)==="object"?i.distinguishedName||i.id||i.unique||i.name:i};var e=null;s.listUnitWithDuty(n,function(t){e=t.data},null,false);return e},getDuty:function(t,i){r();var n={name:t,unit:typeOf(i)==="object"?i.distinguishedName||i.id||i.unique||i.name:i};var e=null;s.getDuty(n,function(t){e=t.data},null,false);return e},listDutyNameWithIdentity:function(t){r();var i={identityList:u(t)};var n=null;s.listDutyNameWithIdentity(i,function(t){n=t.data.nameList},null,false);return n},listDutyNameWithUnit:function(t){r();var i={unitList:u(t)};var n=null;s.listDutyNameWithUnit(i,function(t){n=t.data.nameList},null,false);return n},listUnitAllDuty:function(t){r();var i={unitList:u(t)};var n=null;s.listUnitAllDuty(i,function(t){n=t.data.nameList},null,false);return n},appendUnitAttribute:function(t,i,n){r();var e=typeOf(t)==="object"?t.distinguishedName||t.id||t.unique||t.name:t;var a={attributeList:n,name:i,unit:e};s.appendUnitAttribute(a,function(t){if(t.data.value){if(success)success()}else{if(failure)failure(null,"","append values failed")}},function(t,i,n){if(failure)failure(t,i,n)},false)},setUnitAttribute:function(t,i,n){r();var e=typeOf(t)==="object"?t.distinguishedName||t.id||t.unique||t.name:t;var a={attributeList:n,name:i,unit:e};s.setUnitAttribute(a,function(t){if(t.data.value){if(success)success()}else{if(failure)failure(null,"","append values failed")}},function(t,i,n){if(failure)failure(t,i,n)},false)},getUnitAttribute:function(t,i){r();var n=typeOf(t)==="object"?t.distinguishedName||t.id||t.unique||t.name:t;var e={name:i,unit:n};var a=null;s.getUnitAttribute(e,function(t){a=t.data.attributeList},null,false);return a},listUnitAttributeName:function(t){r();var i={unitList:u(t)};var n=null;s.listUnitAttributeName(i,function(t){n=t.data.nameList},null,false);return n},listUnitAllAttribute:function(t){r();var i={unitList:u(t)};var n=null;s.listUnitAllAttribute(i,function(t){n=t.data},null,false);return n}};this.Action=function(){var e=[];return function(t,i){var n=e[t]||(e[t]=new MWF.xDesktop.Actions.RestActions("",t,""));n.getActions=function(t){if(!this.actions)this.actions={};Object.merge(this.actions,i);if(t)t()};this.invoke=function(t){n.invoke(t)}}}();this.service={jaxwsClient:{},jaxrsClient:{}};var e=null;var l=function(t){if(!e){MWF.require("MWF.xDesktop.Actions.RestActions",function(){e=new MWF.xDesktop.Actions.RestActions("","x_cms_assemble_control","");e.getActions=function(t){this.actions={lookup:{uri:"/jaxrs/queryview/flag/{view}/application/flag/{application}/execute",method:"PUT"},getView:{uri:"/jaxrs/queryview/flag/{view}/application/flag/{application}"}};if(t)t()};if(t)t()}.bind(this))}else{if(t)t()}};this.view={lookup:function(t,n){l(function(){e.invoke({name:"lookup",async:true,parameter:{view:t.view,application:t.application},success:function(t){var i={grid:t.data.grid,groupGrid:t.data.groupGrid};if(n)n(i)}.bind(this)})}.bind(this))},select:function(t,e,a){if(t.view){var s={application:t.application||"",viewName:t.view||"",isTitle:t.isTitle||"yes",select:t.select||"multi",title:t.title||"Select View"};if(!a)a={};var r=a.width||"700";var u=a.height||"400";if(layout.mobile){var i=document.body.getSize();r=i.x;u=i.y;a.style="viewmobile"}r=r.toInt();u=u.toInt();var i=f.app.content.getSize();var l=(i.x-r)/2;var o=(i.y-u)/2;if(l<0)l=0;if(o<0)o=0;if(layout.mobile){l=20;o=0}var c=this;MWF.require("MWF.xDesktop.Dialog",function(){var i=new MWF.xDesktop.Dialog({title:a.title||"select View",style:a.style||"view",top:o,left:l-20,fromTop:o,fromLeft:l-20,width:r,height:u,html:"<div style='height: 100%;'></div>",maskNode:f.app.content,container:f.app.content,buttonList:[{text:MWF.LP.process.button.ok,action:function(){if(e)e(c.view.getData());this.close()}},{text:MWF.LP.process.button.cancel,action:function(){this.close()}}]});i.show();if(layout.mobile){var t=i.node.getElement(".MWF_dialod_Action_back");var n=i.node.getElement(".MWF_dialod_Action_ok");if(t)t.addEvent("click",function(t){i.close()}.bind(this));if(n)n.addEvent("click",function(t){if(e)e(this.view.getData());i.close()}.bind(this))}MWF.xDesktop.requireApp("query.Query","Viewer",function(){this.view=new MWF.xApplication.query.Query.Viewer(i.content.getFirst(),s,{style:"select"})}.bind(this))}.bind(this))}}};if(!window.includedScripts){var o=window.includedScripts=[]}else{var o=window.includedScripts}this.include=function(t,i){var n=t;if(typeOf(n)=="string"){n={name:n}}var e=n.name;var a=n.type&&n.application?n.type:"cms";var s=n.application||f.json.application;if(o.indexOf(e)>-1){if(i)i.apply(this);return}var r;switch(a){case"portal":if(this.scriptActionPortal){r=this.scriptActionPortal}else{MWF.require("MWF.xScript.Actions.PortalScriptActions",null,false);r=this.scriptActionPortal=new MWF.xScript.Actions.PortalScriptActions}break;case"process":if(this.scriptActionProcess){r=this.scriptActionProcess}else{MWF.require("MWF.xScript.Actions.ScriptActions",null,false);r=this.scriptActionProcess=new MWF.xScript.Actions.ScriptActions}break;case"cms":if(this.scriptActionCMS){r=this.scriptActionCMS}else{MWF.require("MWF.xScript.Actions.CMSScriptActions",null,false);r=this.scriptActionCMS=new MWF.xScript.Actions.CMSScriptActions}break}r.getScriptByName(s,e,o,function(t){if(t.data){o=o.concat(t.data.importedList);MWF.Macro.exec(t.data.text,this);if(i)i.apply(this)}else{if(i)i.apply(this)}}.bind(this),null,false)};this.define=function(t,i,n){var e=true;if(n===false)e=false;var a={};a[t]={value:i,configurable:e};MWF.defineProperties(this,a)}.bind(this);this.form={app:function(){return f.app},node:function(){return f.node},get:function(t){return f.all[t]},getField:function(t){return a[t]},getData:function(){return new MWF.xScript.CMSJSONData(f.getData())},save:function(t){f.saveDocument(t)},close:function(){f.closeDocument()},publish:function(t){f.publishDocument()},confirm:function(t,i,n,e,a,s,r,u,l){f.confirm(t,i,n,e,a,s,r,u,l)},notice:function(t,i,n,e){f.notice(t,i,n,e)},addEvent:function(t,i){f.addEvent(t,i)},openPortal:function(t,n,e){var a=MWF.Actions.get("x_portal_assemble_surface");a.getApplication(t,function(i){if(i.data){if(n){a.getPageByName(n,i.data.id,function(t){layout.desktop.openApplication(null,"portal.Portal",{portalId:i.data.id,pageId:t.data?t.data.id:"",parameters:e,appId:"portal.Portal"+i.data.id})})}else{layout.desktop.openApplication(null,"portal.Portal",{portalId:i.data.id,parameters:e,appId:"portal.Portal"+i.data.id})}}})},openCMS:function(t){var i=MWF.Actions.get("x_cms_assemble_control");i.getColumn(t,function(t){if(t.data){layout.desktop.openApplication(null,"cms.Module",{columnId:t.data.id,appId:"cms.Module"+t.data.id})}})},openProcess:function(t){var i=MWF.Actions.get("x_processplatform_assemble_surface");i.getApplication(t,function(t){if(t.data){layout.desktop.openApplication(null,"process.Application",{id:t.data.id,appId:"process.Application"+t.data.id})}})},openApplication:function(t,i){layout.desktop.openApplication(null,t,i)},startProcess:function(t,i){debugger;var n=MWF.Actions.get("x_processplatform_assemble_surface").getProcessByName(i,t,function(i){if(i.data){MWF.xDesktop.requireApp("process.TaskCenter","ProcessStarter",function(){var t=new MWF.xApplication.process.TaskCenter.ProcessStarter(i.data,f.app,{onStarted:function(t,i,n){debugger;var e=[];t.each(function(t){if(t.currentTaskIndex!=-1)e.push(t.taskList[t.currentTaskIndex].work)}.bind(this));if(e.length==1){var a={workId:e[0],appId:e[0]};layout.desktop.openApplication(null,"process.Work",a)}else{}}.bind(this)});t.load()}.bind(this))}})}};this.target=t.target;this.event=t.event;this.status=t.status;this.session=layout.desktop.session};MWF.xScript.CMSJSONData=function(a,s,n,e){var r=function(t,i,n,e){return function(){return["array","object"].indexOf(typeOf(t[n]))==-1?t[n]:new MWF.xScript.CMSJSONData(t[n],i,n,e)}};var u=function(i,n,e,a){return function(t){i[e]=t;if(n)n(i,e,a)}};var t=function(){var t={};for(var i in a)t[i]={configurable:true,get:r.apply(this,[a,s,i,this]),set:u.apply(this,[a,s,i,this])};t["length"]={get:function(){return Object.keys(a).length}};MWF.defineProperties(this,t);this.getKey=function(){return n};this.getParent=function(){return e};this.toString=function(){return a.toString()};this.add=function(t,i){var n=typeOf(a);if(!this.hasOwnProperty(t)){if(n=="array"){a.push(i||{});t=a.length-1}else{a[t]=i||{}}var e={};e[t]={configurable:true,get:r.apply(this,[a,s,t,this]),set:u.apply(this,[a,s,t,this])};MWF.defineProperties(this,e)}this[t]=i;return this};this.del=function(t){if(!this.hasOwnProperty(t))return null;delete a[newKey];delete this[newKey];return this}};var i=typeOf(a);if(i=="object"||i=="array")t.apply(this)};MWF.xScript.createCMSDict=function(i){return function(t){var s=i;this.name=t;MWF.require("MWF.xScript.Actions.CMSDictActions",null,false);var r=new MWF.xScript.Actions.CMSDictActions;this.get=function(t,i,e){if(t){var n=t.replace(/\./g,"/");var a=null;r.getDict(s,encodeURIComponent(this.name),n,function(t){a=t.data;if(i)i(t.data)},function(t,i,n){if(e)e(t,i,n)},false)}else{var a=null;r.getDictWhole(s,encodeURIComponent(this.name),function(t){a=t.data;if(i)i(t.data)},function(t,i,n){if(e)e(t,i,n)},false)}return a};this.set=function(t,i,n,e){var a=t.replace(/\./g,"/");r.setDict(s,encodeURIComponent(this.name),a,i,function(t){if(n)n(t.data)},function(t,i,n){if(e)e(t,i,n)})};this.add=function(t,i,n,e){var a=t.replace(/\./g,"/");r.addDict(s,encodeURIComponent(this.name),a,i,function(t){if(n)n(t.data)},function(t,i,n){if(e)e(t,i,n)})};this["delete"]=function(t,i,e){var n=t.replace(/\./g,"/");r.deleteDict(s,encodeURIComponent(this.name),n,function(t){if(i)i(t.data)},function(t,i,n){if(e)e(t,i,n)})};this.destory=this["delete"]}};